---
interface Props {
  repo: string; // Format: "owner/repo"
}

const { repo } = Astro.props;
const [owner, repoName] = repo.split('/');
const repoUrl = `https://github.com/${repo}`;
const cloneUrl = `${repoUrl}.git`;
---

<div class="github-repo-card">
  <div class="repo-header">
    <a href={repoUrl} target="_blank" rel="noopener noreferrer" class="repo-link">
      <svg viewBox="0 0 16 16" aria-hidden="true" class="github-icon">
        <path
          fill="currentColor"
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
        />
      </svg>
      <span class="repo-name">{owner}/<strong>{repoName}</strong></span>
    </a>
  </div>
  
  <div class="repo-actions">
    <button class="action-btn clone-btn" data-clone-url={cloneUrl} title="Copy clone URL">
      <svg viewBox="0 0 16 16" aria-hidden="true" class="action-icon">
        <path fill="currentColor" d="M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z"/>
        <path fill="currentColor" d="M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z"/>
      </svg>
      <span class="btn-text">Clone</span>
    </button>
    
    <a href={`${repoUrl}/fork`} target="_blank" rel="noopener noreferrer" class="action-btn" title="Fork repository">
      <svg viewBox="0 0 16 16" aria-hidden="true" class="action-icon">
        <path fill="currentColor" d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0ZM5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Zm6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Zm-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0Z"/>
      </svg>
      <span class="btn-text">Fork</span>
    </a>
  </div>
</div>

<script>
  document.querySelectorAll('.clone-btn').forEach(btn => {
    btn.addEventListener('click', async () => {
      const cloneUrl = btn.getAttribute('data-clone-url');
      if (cloneUrl) {
        try {
          await navigator.clipboard.writeText(`git clone ${cloneUrl}`);
          const textSpan = btn.querySelector('.btn-text');
          const originalText = textSpan?.textContent;
          if (textSpan) {
            textSpan.textContent = 'Copied!';
            setTimeout(() => {
              textSpan.textContent = originalText || 'Clone';
            }, 2000);
          }
        } catch (err) {
          console.error('Failed to copy:', err);
        }
      }
    });
  });
</script>

<style>
  .github-repo-card {
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1rem;
    padding: 0.75rem 1rem;
    margin-bottom: 1.5rem;
    background: rgb(var(--bg-secondary));
    border: 1px solid rgb(var(--border-color));
    border-radius: 8px;
    transition: border-color 0.3s ease;
  }

  .github-repo-card:hover {
    border-color: var(--accent);
  }

  .repo-header {
    display: flex;
    align-items: center;
  }

  .repo-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: rgb(var(--text-primary));
    font-size: 1rem;
    transition: color 0.2s ease;
  }

  .repo-link:hover {
    color: var(--accent);
  }

  .github-icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
  }

  .repo-name {
    font-size: 0.95rem;
  }

  .repo-name strong {
    color: var(--accent);
  }

  .repo-actions {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .action-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.4rem 0.75rem;
    background: rgb(var(--bg-primary));
    border: 1px solid rgb(var(--border-color));
    border-radius: 6px;
    color: rgb(var(--text-primary));
    font-size: 0.8rem;
    font-weight: 500;
    font-family: inherit;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .action-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    background: rgb(var(--bg-secondary));
  }

  .action-icon {
    width: 14px;
    height: 14px;
  }

  .btn-text {
    font-weight: 500;
  }

  @media (max-width: 720px) {
    .github-repo-card {
      flex-direction: column;
      align-items: flex-start;
    }

    .repo-actions {
      width: 100%;
      justify-content: flex-start;
    }

    .action-btn {
      flex: 1;
      justify-content: center;
    }
  }
</style>
