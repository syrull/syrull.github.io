<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hack The Box - Sandworm [Medium] | 0x73796C31</title><meta name=keywords content="hackthebox"><meta name=description content="I began with a simple scan, to check the ports of the machine.
$ rustscan -a Open 10.10.11.218:22 Open 10.10.11.218:80 Open 10.10.11.218:443 I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:
https://ssa.htb/login https://ssa.htb/ https://ssa.htb/pgp # the site's public key https://ssa.htb/guide # some sort of playground for PGP https://ssa.htb/contact https://ssa.htb/guide/verify https://ssa.htb/about https://ssa."><meta name=author content="Dimitar Ganev"><link rel=canonical href=https://sy1.sh/writeups/htb-sandworm/><link crossorigin=anonymous href=/assets/css/stylesheet.f8c2ee4fde28779dff9afcd3046f6bd6fc9cbeb1ddf60d48a81b676d7162c1bb.css integrity="sha256-+MLuT94od53/mvzTBG9r1vycvrHd9g1IqBtnbXFiwbs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://sy1.sh/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sy1.sh/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sy1.sh/favicon-32x32.png><link rel=apple-touch-icon href=https://sy1.sh/apple-touch-icon.png><link rel=mask-icon href=https://sy1.sh/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Hack The Box - Sandworm [Medium]"><meta property="og:description" content="I began with a simple scan, to check the ports of the machine.
$ rustscan -a Open 10.10.11.218:22 Open 10.10.11.218:80 Open 10.10.11.218:443 I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:
https://ssa.htb/login https://ssa.htb/ https://ssa.htb/pgp # the site's public key https://ssa.htb/guide # some sort of playground for PGP https://ssa.htb/contact https://ssa.htb/guide/verify https://ssa.htb/about https://ssa."><meta property="og:type" content="article"><meta property="og:url" content="https://sy1.sh/writeups/htb-sandworm/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2023-06-24T10:42:27+03:00"><meta property="article:modified_time" content="2023-06-24T10:42:27+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hack The Box - Sandworm [Medium]"><meta name=twitter:description content="I began with a simple scan, to check the ports of the machine.
$ rustscan -a Open 10.10.11.218:22 Open 10.10.11.218:80 Open 10.10.11.218:443 I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:
https://ssa.htb/login https://ssa.htb/ https://ssa.htb/pgp # the site's public key https://ssa.htb/guide # some sort of playground for PGP https://ssa.htb/contact https://ssa.htb/guide/verify https://ssa.htb/about https://ssa."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Writeups","item":"https://sy1.sh/writeups/"},{"@type":"ListItem","position":3,"name":"Hack The Box - Sandworm [Medium]","item":"https://sy1.sh/writeups/htb-sandworm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hack The Box - Sandworm [Medium]","name":"Hack The Box - Sandworm [Medium]","description":"I began with a simple scan, to check the ports of the machine.\n$ rustscan -a Open 10.10.11.218:22 Open 10.10.11.218:80 Open 10.10.11.218:443 I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:\nhttps://ssa.htb/login https://ssa.htb/ https://ssa.htb/pgp # the site\u0026#39;s public key https://ssa.htb/guide # some sort of playground for PGP https://ssa.htb/contact https://ssa.htb/guide/verify https://ssa.htb/about https://ssa.","keywords":["hackthebox"],"articleBody":"I began with a simple scan, to check the ports of the machine.\n$ rustscan -a Open 10.10.11.218:22 Open 10.10.11.218:80 Open 10.10.11.218:443 I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:\nhttps://ssa.htb/login https://ssa.htb/ https://ssa.htb/pgp # the site's public key https://ssa.htb/guide # some sort of playground for PGP https://ssa.htb/contact https://ssa.htb/guide/verify https://ssa.htb/about https://ssa.htb/login?next=%2Fadmin https://ssa.htb/guide/encrypt In the /guide endpoint there is some sort of playground for PGP, and while I was playing with it, I have noticed that when I am using the verify signature there is output that looked like pulled from the console.\nI’ve enumerated the technologies and versions that the website is using, I found that it used Flask as the main server application and (possibly Flask for the frontend/templating engine).\nRCE When I saw Flask I thought that the application could be using Jinja, so I immediately thought that this could be a potential SSTI. I had only a single entry point that could give me output which was through Verify Signature in the /guide endpoint.\nCrafting the exploit The injection point is the name of the PGP key, so I’ve generated a key called syl.\n$ gpg --gen-key The exploit is described/explained here.\nAfter that, we need to export the public key using this command:\n$ gpg -a -o public_key.key --export syl then we should craft an arbitrary message:\n$ echo 'test' | gpg --clear-sign Common Issues While crafting this, I’ve experienced serious hassles such as:\nwrongfully crafting the message using different key to encrypt the message I fixed those issues when I started clean and using only 1 key, and whenever asked for anything “passphrase/name” I just typed “syl”.\nTo check the current keys that you have:\n$ gpg --list-keys Another useful website is this one: https://www.sobyte.net/post/2021-12/modify-gpg-uid-name/ I’ve used the article to modify the name of the key, and then to export the public key again.\nUpon crafting the message, paste the message and the public key and click to verify the signature, this would get you a reverse shell to the machine.\nAtlas (firejailed) The user that we got atlas is actually is firejailed, commands such as wget/curl are not available in the environment. The pivot point is in the httpie directory in the $HOME folder. There you can find the admin.json file where the SSH credentials for the user silentobserver are.\nsilentobserver I ran linpeas.sh to check where would my next pivoting point would be, I stumbled fairly fast on these files that I could write:\n/opt/crates/logger/src\r/opt/crates/logger/src/lib.rs I noticed the application located in the /opt directory /opt/tipnet/ I’ve examined the source code, and it is some sort of rust application, I already got a hint to those writable directories and whenever I saw the source code:\nextern crate logger; ... logger::log(username, keywords.as_str().trim(), justification.as_str()); // Invoking it later on. I knew that I could modify the crate that could be executed by the application.\nBut what is this application? And where is it running?\nTipnet Application This application is running like that:\n/bin/sh -c cd /opt/tipnet \u0026\u0026 bin/echo \"e\" | /bin/sudo -u atlas /usr/bin/cargo run --offline sleep 10 We can see the user atlas(not firejailed) is running it, so this could be our next attack vector.\nI’ve crafted a rust reverse shell: https://doc.rust-lang.org/std/process/struct.Command.html and added it into the logger/src/lib.rs file then I build the crate using cargo build.\nAfter some seconds, your listener should be getting a connection from the server, that would be the atlas user.\nAtlas user to root Fairly simple and straightforward, this is a CVE-2022-31214 vulnerability. You can use the already crafted exploits for that:\nhttps://www.openwall.com/lists/oss-security/2022/06/08/10 There are issues with that exploit, I believe it is in the wait mechanism. To make sure that it is working correctly add a breakpoint() in the beginning of the script then you can follow the execution by pressing “n”.\n","wordCount":"655","inLanguage":"en","datePublished":"2023-06-24T10:42:27+03:00","dateModified":"2023-06-24T10:42:27+03:00","author":{"@type":"Person","name":"Dimitar Ganev"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sy1.sh/writeups/htb-sandworm/"},"publisher":{"@type":"Organization","name":"0x73796C31","logo":{"@type":"ImageObject","url":"https://sy1.sh/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sy1.sh accesskey=h title="0x73796C31 (Alt + H)">0x73796C31</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sy1.sh/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://sy1.sh/cv title=CV><span>About</span></a></li><li><a href=https://sy1.sh/writeups/ title=Write-ups><span>Write-ups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sy1.sh>Home</a>&nbsp;»&nbsp;<a href=https://sy1.sh/writeups/>Writeups</a></div><h1 class=post-title>Hack The Box - Sandworm [Medium]</h1><div class=post-meta><span title='2023-06-24 10:42:27 +0300 +0300'>June 24, 2023</span>&nbsp;·&nbsp;4 min</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><ul><li><a href=#rce aria-label=RCE>RCE</a><ul><li><a href=#crafting-the-exploit aria-label="Crafting the exploit">Crafting the exploit</a></li><li><a href=#common-issues aria-label="Common Issues">Common Issues</a></li></ul></li><li><a href=#atlas-firejailed aria-label="Atlas (firejailed)">Atlas (<code>firejailed</code>)</a></li><li><a href=#silentobserver aria-label=silentobserver><code>silentobserver</code></a></li><li><a href=#tipnet-application aria-label="Tipnet Application"><code>Tipnet</code> Application</a></li></ul><li><a href=#atlas-user-to-root aria-label="Atlas user to root"><code>Atlas</code> user to <code>root</code></a></li></ul></div></details></div><div class=post-content><p>I began with a simple scan, to check the ports of the machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ rustscan -a 
</span></span><span class=line><span class=cl>Open 10.10.11.218:22
</span></span><span class=line><span class=cl>Open 10.10.11.218:80
</span></span><span class=line><span class=cl>Open 10.10.11.218:443
</span></span></code></pre></div><p>I went to the website that is being hosted on port 80, and I saw that there is some sort of PGP stuff. Furthermore, I noticed the following URLs:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=err>https://ssa.htb/login
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/pgp # the site&#39;s public key
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/guide # some sort of playground for PGP
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/contact
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/guide/verify
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/about
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/login?next=%2Fadmin
</span></span></span><span class=line><span class=cl><span class=err>https://ssa.htb/guide/encrypt
</span></span></span></code></pre></div><p>In the <code>/guide</code> endpoint there is some sort of playground for PGP, and while I was playing with it, I have noticed that when I am using the verify signature there is output that looked like pulled from the console.</p><p>I&rsquo;ve enumerated the technologies and versions that the website is using, I found that it used Flask as the main server application and (possibly Flask for the frontend/templating engine).</p><h2 id=rce>RCE<a hidden class=anchor aria-hidden=true href=#rce>#</a></h2><p>When I saw Flask I thought that the application could be using Jinja, so I immediately thought that this could be a potential <a href=https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection>SSTI</a>.
I had only a single entry point that could give me output which was through <code>Verify Signature</code> in the <code>/guide</code> endpoint.</p><h3 id=crafting-the-exploit>Crafting the exploit<a hidden class=anchor aria-hidden=true href=#crafting-the-exploit>#</a></h3><p>The injection point is the <code>name</code> of the PGP key, so I&rsquo;ve generated a key called <code>syl</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpg --gen-key
</span></span></code></pre></div><p>The exploit is described/explained <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2>here</a>.</p><p>After that, we need to export the public key using this command:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ gpg -a -o public_key.key --export syl
</span></span></code></pre></div><p>then we should craft an arbitrary message:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ <span class=nb>echo</span> <span class=s1>&#39;test&#39;</span> <span class=p>|</span> gpg --clear-sign
</span></span></code></pre></div><hr><h3 id=common-issues>Common Issues<a hidden class=anchor aria-hidden=true href=#common-issues>#</a></h3><p>While crafting this, I&rsquo;ve experienced serious hassles such as:</p><ul><li>wrongfully crafting the message</li><li>using different key to encrypt the message</li></ul><p>I fixed those issues when I started clean and using only 1 key, and whenever asked for anything &ldquo;passphrase/name&rdquo; I just typed &ldquo;syl&rdquo;.</p><p>To check the current keys that you have:</p><pre tabindex=0><code>$ gpg --list-keys
</code></pre><p>Another useful website is this one: <a href=https://www.sobyte.net/post/2021-12/modify-gpg-uid-name/>https://www.sobyte.net/post/2021-12/modify-gpg-uid-name/</a> I&rsquo;ve used the article to modify the name of the key, and then to export the public key again.</p><hr><p>Upon crafting the message, paste the message and the public key and click to verify the signature, this would get you a reverse shell to the machine.</p><h2 id=atlas-firejailed>Atlas (<code>firejailed</code>)<a hidden class=anchor aria-hidden=true href=#atlas-firejailed>#</a></h2><p>The user that we got <code>atlas</code> is actually is <code>firejailed</code>, commands such as <code>wget/curl</code> are not available in the environment. The pivot point is in the <code>httpie</code> directory in the <code>$HOME</code> folder. There you can find the <code>admin.json</code> file where the SSH credentials for the user <code>silentobserver</code> are.</p><h2 id=silentobserver><code>silentobserver</code><a hidden class=anchor aria-hidden=true href=#silentobserver>#</a></h2><p>I ran <code>linpeas.sh</code> to check where would my next pivoting point would be, I stumbled fairly fast on these files that I could write:</p><pre tabindex=0><code>/opt/crates/logger/src
/opt/crates/logger/src/lib.rs
</code></pre><p>I noticed the application located in the <code>/opt</code> directory <code>/opt/tipnet/</code> I&rsquo;ve examined the source code, and it is some sort of <code>rust</code> application, I already got a hint to those writable directories and whenever I saw the source code:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-rust data-lang=rust><span class=line><span class=cl><span class=k>extern</span><span class=w> </span><span class=k>crate</span><span class=w> </span><span class=n>logger</span><span class=p>;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=o>..</span><span class=p>.</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>logger</span>::<span class=n>log</span><span class=p>(</span><span class=n>username</span><span class=p>,</span><span class=w> </span><span class=n>keywords</span><span class=p>.</span><span class=n>as_str</span><span class=p>().</span><span class=n>trim</span><span class=p>(),</span><span class=w> </span><span class=n>justification</span><span class=p>.</span><span class=n>as_str</span><span class=p>());</span><span class=w> </span><span class=c1>// Invoking it later on.
</span></span></span></code></pre></div><p>I knew that I could modify the crate that could be executed by the application.</p><p>But what is this application? And where is it running?</p><h2 id=tipnet-application><code>Tipnet</code> Application<a hidden class=anchor aria-hidden=true href=#tipnet-application>#</a></h2><p>This application is running like that:</p><pre tabindex=0><code>/bin/sh -c cd /opt/tipnet &amp;&amp; bin/echo &#34;e&#34; | /bin/sudo -u atlas /usr/bin/cargo run --offline sleep 10
</code></pre><p>We can see the user <code>atlas(not firejailed)</code> is running it, so this could be our next attack vector.</p><p>I&rsquo;ve crafted a rust reverse shell: <a href=https://doc.rust-lang.org/std/process/struct.Command.html>https://doc.rust-lang.org/std/process/struct.Command.html</a> and added it into the <code>logger/src/lib.rs</code> file then I build the crate using <code>cargo build</code>.</p><p>After some seconds, your listener should be getting a connection from the server, that would be the <code>atlas</code> user.</p><h1 id=atlas-user-to-root><code>Atlas</code> user to <code>root</code><a hidden class=anchor aria-hidden=true href=#atlas-user-to-root>#</a></h1><p>Fairly simple and straightforward, this is a <a href=https://github.com/advisories/GHSA-m2xv-wgqg-4gxh title=CVE-2022-31214>CVE-2022-31214</a> vulnerability. You can use the already crafted exploits for that:</p><ul><li><a href=https://www.openwall.com/lists/oss-security/2022/06/08/10>https://www.openwall.com/lists/oss-security/2022/06/08/10</a></li></ul><p>There are issues with that exploit, I believe it is in the <code>wait</code> mechanism. To make sure that it is working correctly add a <code>breakpoint()</code> in the beginning of the script then you can follow the execution by pressing &ldquo;n&rdquo;.</p><p><img loading=lazy src=/htb/htb-sandworm-firejail.png alt=rwojak></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://sy1.sh/tags/hackthebox/>hackthebox</a></li></ul><nav class=paginav><a class=prev href=https://sy1.sh/writeups/htb-pilgrimage/><span class=title>« Prev</span><br><span>Hack The Box - Pilgrimage [Easy]</span></a>
<a class=next href=https://sy1.sh/writeups/htb-busqueda/><span class=title>Next »</span><br><span>Hack The Box - Busqueda [Easy]</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://sy1.sh>0x73796C31</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod (sy1 modified)</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>